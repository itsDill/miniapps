<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farm Dashboard - AgriSense</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  </head>
  <body class="builder-page">
    <!-- Trial Banner (shown when not logged in) -->
    <div class="trial-banner" id="trialBanner" style="display: none">
      üå± You're using AgriSense in trial mode.
      <a href="signup.html">Sign up free</a> to save your dashboard and connect
      sensors.
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
      <div class="login-modal-content">
        <h3>Connect Your Sensors</h3>
        <p>
          Create a free account to connect your sensors and unlock all features.
        </p>
        <div class="login-modal-buttons">
          <a
            href="signup.html"
            class="btn btn-primary"
            style="text-decoration: none"
            >Start Free Trial</a
          >
          <a
            href="login.html"
            class="btn btn-secondary"
            style="text-decoration: none"
            >Log In</a
          >
          <button class="btn btn-text" onclick="closeLoginModal()">
            Continue in Trial Mode
          </button>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header class="builder-header">
      <div class="header-left">
        <a href="index.html" class="logo-link">
          <div class="logo-icon">üå±</div>
          <span class="logo-text">AgriSense</span>
        </a>
        <select id="dashboardSelect" class="dashboard-select">
          <option value="default">My Farm</option>
        </select>
      </div>
      <div class="header-right">
        <button
          id="importDataBtn"
          class="btn btn-small btn-secondary"
          title="Import data"
        >
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
            style="margin-right: 4px"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
            />
          </svg>
          Import Data
        </button>
        <button id="newDashboardBtn" class="btn btn-small btn-primary">
          + New Dashboard
        </button>
        <button
          id="darkModeBtn"
          class="btn btn-small btn-icon"
          title="Toggle dark mode"
        >
          <svg
            id="moonIcon"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            />
          </svg>
          <svg
            id="sunIcon"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
            style="display: none"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            />
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <div class="builder-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <h3 class="sidebar-title">Sensor Widgets</h3>
        <p class="sidebar-hint">Add widgets to monitor your farm</p>
        <div class="widget-list">
          <button
            class="widget-btn"
            data-widget="soilMoisture"
            draggable="true"
          >
            <span class="widget-icon">üíß</span>
            <span>Soil Moisture</span>
          </button>
          <button class="widget-btn" data-widget="temperature" draggable="true">
            <span class="widget-icon">üå°Ô∏è</span>
            <span>Temperature</span>
          </button>
          <button class="widget-btn" data-widget="cropHealth" draggable="true">
            <span class="widget-icon">üå±</span>
            <span>Crop Health</span>
          </button>
          <button
            class="widget-btn"
            data-widget="weatherStation"
            draggable="true"
          >
            <span class="widget-icon">üå§Ô∏è</span>
            <span>Weather</span>
          </button>
          <button
            class="widget-btn"
            data-widget="sensorStatus"
            draggable="true"
          >
            <span class="widget-icon">üì°</span>
            <span>Sensor Status</span>
          </button>
          <button
            class="widget-btn"
            data-widget="irrigationControl"
            draggable="true"
          >
            <span class="widget-icon">üí¶</span>
            <span>Irrigation</span>
          </button>
          <button
            class="widget-btn"
            data-widget="yieldForecast"
            draggable="true"
          >
            <span class="widget-icon">üìä</span>
            <span>Yield Forecast</span>
          </button>
          <button class="widget-btn" data-widget="chart" draggable="true">
            <span class="widget-icon">üìà</span>
            <span>Chart</span>
          </button>
          <button class="widget-btn" data-widget="datatable" draggable="true">
            <span class="widget-icon">üìã</span>
            <span>Data Table</span>
          </button>
          <button class="widget-btn" data-widget="notes" draggable="true">
            <span class="widget-icon">üìù</span>
            <span>Notes</span>
          </button>
        </div>
      </aside>

      <!-- Canvas -->
      <main class="canvas" id="canvas">
        <div class="canvas-grid" id="canvasGrid">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">üåæ</div>
            <h2 class="empty-title">Build Your Farm Dashboard</h2>
            <p class="empty-desc">
              Add widgets to monitor soil, weather, crops and more from your
              sensors
            </p>
            <div class="drop-zone-hint">
              <svg
                width="24"
                height="24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
                />
              </svg>
              <span>Drop widgets here</span>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- New Dashboard Modal -->
    <div id="newDashboardModal" class="modal">
      <div class="modal-content">
        <h3 class="modal-title">Create New Dashboard</h3>
        <input
          type="text"
          id="dashboardNameInput"
          class="modal-input"
          placeholder="Dashboard name"
          autofocus
        />
        <div class="modal-buttons">
          <button id="createDashboardBtn" class="btn btn-primary">
            Create
          </button>
          <button id="cancelDashboardBtn" class="btn btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Import Data Modal -->
    <div id="importDataModal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h3 class="modal-title">Import Data</h3>
          <button class="modal-close" id="closeImportModal">&times;</button>
        </div>

        <!-- Security Notice -->
        <div class="security-notice">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
            />
          </svg>
          <span
            >Your data stays private ‚Äî all processing happens in your browser,
            nothing is sent to any server.</span
          >
        </div>

        <div class="import-tabs">
          <button class="import-tab active" data-tab="file">
            <svg
              width="20"
              height="20"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            File Upload
          </button>
          <button class="import-tab" data-tab="sheets">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19 11V9h-4V4h-2v5H8V4H6v5H2v2h4v4H2v2h4v5h2v-5h5v5h2v-5h4v-2h-4v-4h4zm-6 4H8v-4h5v4z"
              />
            </svg>
            Google Sheets
          </button>
          <button class="import-tab" data-tab="paste">
            <svg
              width="20"
              height="20"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
              />
            </svg>
            Paste Data
          </button>
        </div>

        <!-- File Upload Tab -->
        <div class="import-content active" id="tab-file">
          <div class="file-drop-zone" id="fileDropZone">
            <svg
              width="48"
              height="48"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"
              />
            </svg>
            <p class="drop-zone-text">Drag & drop your file here</p>
            <p class="drop-zone-subtext">or click to browse</p>
            <input
              type="file"
              id="fileInput"
              accept=".csv,.json,.xlsx,.xls"
              hidden
            />
            <div class="supported-formats">
              <span class="format-badge">CSV</span>
              <span class="format-badge">JSON</span>
              <span class="format-badge">Excel</span>
            </div>
          </div>
        </div>

        <!-- Google Sheets Tab -->
        <div class="import-content" id="tab-sheets">
          <div class="sheets-input-group">
            <label class="input-label">Google Sheets URL or ID</label>
            <input
              type="text"
              id="sheetsUrl"
              class="modal-input"
              placeholder="https://docs.google.com/spreadsheets/d/..."
            />
            <p class="input-hint">
              Make sure your sheet is publicly accessible (Anyone with link can
              view)
            </p>
          </div>
          <div class="sheets-input-group">
            <label class="input-label">Sheet Name (optional)</label>
            <input
              type="text"
              id="sheetName"
              class="modal-input"
              placeholder="Sheet1"
            />
          </div>
          <button id="loadSheetsBtn" class="btn btn-primary btn-full">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
              style="margin-right: 8px"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
              />
            </svg>
            Load from Google Sheets
          </button>
        </div>

        <!-- Paste Data Tab -->
        <div class="import-content" id="tab-paste">
          <div class="paste-input-group">
            <label class="input-label">Paste your data (CSV format)</label>
            <textarea
              id="pasteData"
              class="modal-textarea"
              placeholder="Name, Age, City&#10;John, 25, New York&#10;Jane, 30, Los Angeles"
              rows="8"
            ></textarea>
          </div>
          <button id="parsePastedBtn" class="btn btn-primary btn-full">
            Parse Data
          </button>
        </div>

        <!-- Data Preview -->
        <div class="data-preview" id="dataPreview" style="display: none">
          <div class="preview-header">
            <h4>Data Preview</h4>
            <span class="preview-info" id="previewInfo"></span>
          </div>
          <div class="preview-table-wrapper">
            <table class="preview-table" id="previewTable">
              <thead></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="preview-actions">
            <select id="widgetTypeSelect" class="modal-input">
              <option value="datatable">Data Table Widget</option>
              <option value="chart">Chart Widget</option>
            </select>
            <button id="addDataWidgetBtn" class="btn btn-primary">
              Add to Dashboard
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Widget Configuration Modal -->
    <div id="widgetConfigModal" class="modal">
      <div class="modal-content modal-medium">
        <div class="modal-header">
          <h3 class="modal-title">Configure Widget</h3>
          <button class="modal-close" id="closeWidgetConfig">&times;</button>
        </div>

        <div class="config-widget-type" id="configWidgetType">Clock</div>

        <div class="config-section">
          <h4 class="config-section-title">Appearance</h4>

          <div class="config-group">
            <label class="config-label">Widget Title (optional)</label>
            <input
              type="text"
              id="widgetTitle"
              class="config-input"
              placeholder="Custom title..."
            />
          </div>

          <div class="config-group">
            <label class="config-label">Background Color</label>
            <div class="color-presets">
              <button
                class="color-preset active"
                data-color="#ffffff"
                style="background: #ffffff"
              ></button>
              <button
                class="color-preset"
                data-color="#f0f9ff"
                style="background: #f0f9ff"
              ></button>
              <button
                class="color-preset"
                data-color="#f0fdf4"
                style="background: #f0fdf4"
              ></button>
              <button
                class="color-preset"
                data-color="#fef3c7"
                style="background: #fef3c7"
              ></button>
              <button
                class="color-preset"
                data-color="#fce7f3"
                style="background: #fce7f3"
              ></button>
              <button
                class="color-preset"
                data-color="#ede9fe"
                style="background: #ede9fe"
              ></button>
              <button
                class="color-preset"
                data-color="#1e293b"
                style="background: #1e293b"
              ></button>
            </div>
            <input
              type="color"
              id="widgetBgColor"
              class="config-color-picker"
              value="#ffffff"
            />
          </div>

          <div class="config-group">
            <label class="config-label">Size</label>
            <div class="size-presets">
              <button class="size-preset" data-size="small">
                <span class="size-icon">‚ñ´Ô∏è</span>
                <span>Small</span>
              </button>
              <button class="size-preset active" data-size="medium">
                <span class="size-icon">‚óªÔ∏è</span>
                <span>Medium</span>
              </button>
              <button class="size-preset" data-size="large">
                <span class="size-icon">‚¨ú</span>
                <span>Large</span>
              </button>
            </div>
          </div>
        </div>

        <div class="config-section">
          <h4 class="config-section-title">Content</h4>
          <div id="widgetContentConfig">
            <!-- Dynamic content based on widget type -->
          </div>
        </div>

        <div class="modal-buttons">
          <button id="createWidgetBtn" class="btn btn-primary">
            Add Widget
          </button>
          <button id="cancelWidgetConfig" class="btn btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <script src="dashboard.js"></script>
    <script src="widgets.js"></script>
    <script src="data-import.js"></script>
  </body>
</html>
