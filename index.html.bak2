<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no"
    />
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta
      name="description"
      content="Professional widgets for work and productivity. Access tools for business, technology, wellness, and operations."
    />
    <title>iowidgets - Professional Tools Collection</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkMSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzRBOTBFMjtzdG9wLW9wYWNpdHk6MSIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2MzY2RjE7c3RvcC1vcGFjaXR5OjEiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSIzNiIgZmlsbD0idXJsKCNncmFkMSkiLz48Y2lyY2xlIGN4PSI2MCIgY3k9IjYwIiByPSIyMCIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuOSIvPjxjaXJjbGUgY3g9IjEyMCIgY3k9IjYwIiByPSIyMCIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuOSIvPjxjaXJjbGUgY3g9IjYwIiBjeT0iMTIwIiByPSIyMCIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuOSIvPjxjaXJjbGUgY3g9IjEyMCIgY3k9IjEyMCIgcj0iMjAiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjkiLz48L3N2Zz4="
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Prevent layout shifts and ensure smooth rendering */
      html,
      body {
        height: 100%;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
      }

      body {
        font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, sans-serif;
        /* Work Mode - Professional & Focused */
        background: linear-gradient(
          135deg,
          #1e3a8a 0%,
          #3730a3 25%,
          #6366f1 50%,
          #8b5cf6 75%,
          #a855f7 100%
        );
        background-size: 400% 400%;
        animation: workGradient 15s ease infinite;
        min-height: 100vh;
        overflow-x: hidden;
        color: #fff;
        position: relative;
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 300;
        letter-spacing: -0.01em;
      }

      body.fun-mode {
        /* Fun Mode - Vibrant & Playful */
        background: linear-gradient(
          135deg,
          #ec4899 0%,
          #f97316 25%,
          #eab308 50%,
          #22c55e 75%,
          #06b6d4 100%
        );
        background-size: 400% 400%;
        animation: funGradient 12s ease infinite;
      }

      body.learn-mode {
        /* Learn Mode - Calm & Focused */
        background: linear-gradient(
          135deg,
          #6366f1 0%,
          #8b5cf6 25%,
          #06b6d4 50%,
          #10b981 75%,
          #3b82f6 100%
        );
        background-size: 300% 300%;
        animation: learnGradient 15s ease infinite;
      }

      @keyframes workGradient {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      @keyframes funGradient {
        0%,
        100% {
          background-position: 0% 50%;
        }
        33% {
          background-position: 100% 0%;
        }
        66% {
          background-position: 0% 100%;
        }
      }

      @keyframes learnGradient {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      /* Multiple fallback layers to prevent black screens */
      html {
        background-color: #667eea;
      }

      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        z-index: -1;
        pointer-events: none;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(255, 255, 255, 0.02) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 255, 255, 0.02) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 80%,
            rgba(255, 255, 255, 0.02) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: 1;
        opacity: 0.7;
      }

      body.fun-mode::before {
        background: radial-gradient(
            circle at 30% 30%,
            rgba(255, 255, 255, 0.08) 0%,
            transparent 60%
          ),
          radial-gradient(
            circle at 70% 70%,
            rgba(255, 255, 255, 0.06) 0%,
            transparent 60%
          ),
          radial-gradient(
            circle at 50% 90%,
            rgba(255, 255, 255, 0.04) 0%,
            transparent 50%
          );
        opacity: 0.8;
      }

      /* Subtle notification styling */
      .notification {
        position: fixed;
        top: 2rem;
        right: 50%;
        transform: translateX(50%) translateY(-100px);
        padding: 0.75rem 1.5rem;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 400;
        z-index: 1100;
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        max-width: 300px;
        text-align: center;
        opacity: 0;
      }

      .notification.show {
        transform: translateX(50%) translateY(0);
        opacity: 1;
      }

      .notification.error {
        background: rgba(239, 68, 68, 0.9);
        border-color: rgba(239, 68, 68, 0.3);
      }

      .notification.success {
        background: rgba(34, 197, 94, 0.9);
        border-color: rgba(34, 197, 94, 0.3);
      }

      /* Elegant Mode Toggle */
      .mode-toggle-container {
        position: fixed;
        top: 2rem;
        right: 2rem;
        z-index: 1000;
        display: flex;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 50px;
        padding: 4px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .mode-toggle {
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.85rem;
        font-weight: 500;
        letter-spacing: 0.025em;
        text-transform: uppercase;
        border: none;
        background: none;
        color: rgba(255, 255, 255, 0.6);
        user-select: none;
        position: relative;
        overflow: hidden;
      }

      .mode-toggle.active {
        background: rgba(255, 255, 255, 0.2);
        color: #ffffff;
        transform: scale(1.02);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .mode-toggle:hover:not(.active) {
        color: rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.05);
      }

      .mode-toggle::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .mode-toggle:hover::before {
        left: 100%;
      }

      .corner-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .corner-label {
        font-size: 0.8rem;
        opacity: 0.9;
      }

      /* Elegant floating animation for widgets */
      @keyframes gentleFloat {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-3px);
        }
      }

      /* Smooth entrance animation */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .header {
        text-align: center;
        padding: 4rem 2rem 2rem;
        position: relative;
        z-index: 10;
        max-width: 800px;
        margin: 0 auto;
      }

      .header h1 {
        font-size: clamp(2.5rem, 8vw, 4rem);
        font-weight: 200;
        margin-bottom: 1rem;
        letter-spacing: -0.02em;
        background: linear-gradient(
          135deg,
          #ffffff 0%,
          rgba(255, 255, 255, 0.8) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
      }

      .header h1::after {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.5),
          transparent
        );
        border-radius: 2px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.75;
        font-weight: 300;
        margin-bottom: 0.5rem;
        letter-spacing: 0.01em;
      }

      .header .subtitle {
        font-size: 0.9rem;
        opacity: 0.6;
        font-weight: 400;
        margin-bottom: 2rem;
        font-style: italic;
      }

      /* Favorites Toggle - Subtle and Elegant */
      .favorites-toggle {
        position: fixed;
        top: 2rem;
        left: 2rem;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 50px;
        padding: 0.75rem 1.25rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 1000;
        text-transform: uppercase;
        letter-spacing: 0.025em;
        user-select: none;
      }

      .favorites-toggle:hover {
        background: rgba(255, 255, 255, 0.15);
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-1px);
      }

      .favorites-toggle.active {
        background: rgba(255, 215, 0, 0.2);
        color: #ffd700;
        border-color: rgba(255, 215, 0, 0.3);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
      }

      .favorites-toggle.active:hover {
        background: rgba(255, 215, 0, 0.3);
      }

      /* Search Bar - Minimal and Clean */
      .search-container {
        display: flex;
        justify-content: center;
        padding: 0 2rem 1.5rem;
        position: relative;
        z-index: 10;
      }

      .search-wrapper {
        position: relative;
        width: 100%;
        max-width: 400px;
      }

      .search-box {
        width: 100%;
        padding: 1rem 1.5rem 1rem 2.5rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        border-radius: 25px;
        color: white;
        font-size: 0.95rem;
        font-weight: 300;
        outline: none;
        transition: all 0.4s ease;
      }

      .search-box::placeholder {
        color: rgba(255, 255, 255, 0.5);
        font-weight: 300;
      }

      /* Search result highlighting */
      .app-name .highlight {
        background: rgba(255, 255, 0, 0.3);
        padding: 2px 4px;
        border-radius: 4px;
        font-weight: 500;
      }

      /* Empty state styling */
      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        opacity: 0.7;
        animation: fadeIn 0.5s ease;
      }

      .empty-state h3 {
        font-size: 1.5rem;
        font-weight: 300;
        margin-bottom: 1rem;
        color: rgba(255, 255, 255, 0.8);
      }

      .empty-state p {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.6);
        max-width: 300px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .search-box:focus {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 0.875rem;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.4);
        font-size: 1rem;
        pointer-events: none;
      }

      /* Category Filters - Subtle Pills */
      .filter-container {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        padding: 0 2rem 2rem;
        flex-wrap: wrap;
        position: relative;
        z-index: 10;
        max-width: 600px;
        margin: 0 auto;
      }

      .filter-btn {
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 400;
        white-space: nowrap;
        letter-spacing: 0.025em;
        text-transform: uppercase;
      }

      .filter-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-1px);
      }

      .filter-btn.active {
        background: rgba(255, 255, 255, 0.2);
        color: #ffffff;
        border-color: rgba(255, 255, 255, 0.3);
        font-weight: 500;
      }

      .apps-container {
        position: relative;
        width: 100%;
        min-height: calc(100vh - 350px);
        padding: 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .apps-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(min(140px, 100%), 1fr));
        gap: clamp(1rem, 3vw, 2rem);
        max-width: 1200px;
        width: 100%;
        position: relative;
        justify-items: center;
        padding: 0 1rem;
      }

      .app-bubble {
        width: 140px;
        height: 140px;
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        position: relative;
        justify-self: center;
        opacity: 0;
        transform: translateY(20px) scale(0.95);
        overflow: hidden;
        will-change: transform, opacity;
      }

      .app-bubble.has-image {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      .app-bubble.has-image::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(1px);
        border-radius: 28px;
      }

      .app-bubble.has-image .app-icon,
      .app-bubble.has-image .app-name {
        position: relative;
        z-index: 2;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }

      .app-bubble.visible {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      .app-bubble:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateY(-8px) scale(1.05);
        border-color: rgba(255, 255, 255, 0.25);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      }

      .app-bubble:active {
        transform: translateY(-4px) scale(1.02);
      }

      .app-bubble:hover .app-icon {
        transform: scale(1.1);
        filter: brightness(1.2);
      }

      .app-bubble:hover .app-name {
        color: rgba(255, 255, 255, 1);
      }

      .app-bubble:focus {
        outline: 3px solid rgba(255, 255, 255, 0.6);
        outline-offset: 2px;
      }

      .app-bubble:focus-visible {
        outline: 3px solid rgba(74, 144, 226, 0.8);
        outline-offset: 2px;
      }

      .app-bubble.custom {
        border-style: dashed;
        border-color: rgba(34, 197, 94, 0.6);
        background: rgba(34, 197, 94, 0.1);
      }

      /* Elegant Favorite Heart */
      .favorite-heart {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        width: 20px;
        height: 20px;
        cursor: pointer;
        z-index: 10;
        opacity: 0;
        transition: all 0.3s ease;
        color: rgba(255, 255, 255, 0.4);
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .app-bubble:hover .favorite-heart {
        opacity: 1;
      }

      .favorite-heart:hover {
        color: #ff6b9d;
        transform: scale(1.2);
      }

      .favorite-heart.favorited {
        opacity: 1;
        color: #ff6b9d;
        filter: drop-shadow(0 0 8px rgba(255, 107, 157, 0.4));
      }

      .favorite-heart.favorited:hover {
        transform: scale(1.3);
      }

      /* Subtle favorited indicator */
      .app-bubble.favorited {
        border-color: rgba(255, 107, 157, 0.3);
        background: rgba(255, 107, 157, 0.05);
      }

      .app-bubble.favorited::after {
        content: "";
        position: absolute;
        top: -1px;
        left: -1px;
        right: -1px;
        bottom: -1px;
        border-radius: 25px;
        background: linear-gradient(
          135deg,
          rgba(255, 107, 157, 0.2),
          transparent,
          rgba(255, 107, 157, 0.1)
        );
        z-index: -1;
        opacity: 0.6;
      }

      /* Professional Category Styling */
      .app-bubble.category-business {
        border-color: rgba(34, 197, 94, 0.2);
      }

      .app-bubble.category-business .app-icon {
        color: rgba(34, 197, 94, 0.9);
      }

      .app-bubble.category-technology {
        border-color: rgba(139, 69, 193, 0.2);
      }

      .app-bubble.category-technology .app-icon {
        color: rgba(139, 69, 193, 0.9);
      }

      .app-bubble.category-wellness {
        border-color: rgba(236, 72, 153, 0.2);
      }

      .app-bubble.category-wellness .app-icon {
        color: rgba(236, 72, 153, 0.9);
      }

      .app-bubble.category-operations {
        border-color: rgba(59, 130, 246, 0.2);
      }

      .app-bubble.category-operations .app-icon {
        color: rgba(59, 130, 246, 0.9);
      }

      .app-bubble.category-general {
        border-color: rgba(34, 197, 94, 0.2);
      }

      .app-bubble.category-general .app-icon {
        color: rgba(34, 197, 94, 0.9);
      }

      .app-bubble.category-learn {
        border-color: rgba(99, 102, 241, 0.2);
      }

      .app-bubble.category-learn .app-icon {
        color: rgba(99, 102, 241, 0.9);
      }

      /* Fun mode gets more vibrant colors */
      body.fun-mode .app-bubble.category-business .app-icon {
        color: rgba(34, 197, 94, 1);
      }

      body.fun-mode .app-bubble.category-technology .app-icon {
        color: rgba(139, 69, 193, 1);
      }

      body.fun-mode .app-bubble.category-wellness .app-icon {
        color: rgba(236, 72, 153, 1);
      }

      body.fun-mode .app-bubble.category-operations .app-icon {
        color: rgba(59, 130, 246, 1);
      }

      body.fun-mode .app-bubble.category-general .app-icon {
        color: rgba(255, 193, 7, 1);
      }

      /* Learn mode gets calming, focused colors */
      body.learn-mode .app-bubble.category-learn .app-icon {
        color: rgba(99, 102, 241, 1);
      }

      body.learn-mode .app-bubble.category-wellness .app-icon {
        color: rgba(16, 185, 129, 1);
      }

      /* Keyboard Shortcuts Hint */
      .shortcuts-hint {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 0.75rem 1rem;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.7);
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .shortcuts-hint.show {
        opacity: 1;
        transform: translateY(0);
      }

      .shortcuts-hint kbd {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        padding: 2px 6px;
        font-family: monospace;
        font-size: 0.7rem;
        margin: 0 2px;
      }

      /* Keyboard Navigation Selection */
      .app-bubble.keyboard-selected {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 20px 40px rgba(74, 144, 226, 0.4),
          0 0 0 3px rgba(74, 144, 226, 0.6),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
        z-index: 100;
        background: linear-gradient(
          135deg,
          rgba(74, 144, 226, 0.3) 0%,
          rgba(99, 102, 241, 0.2) 50%,
          rgba(168, 85, 247, 0.3) 100%
        );
        border-color: rgba(74, 144, 226, 0.8);
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 20px 40px rgba(74, 144, 226, 0.4),
            0 0 0 3px rgba(74, 144, 226, 0.6);
        }
        50% {
          box-shadow: 0 25px 50px rgba(74, 144, 226, 0.6),
            0 0 0 5px rgba(74, 144, 226, 0.8);
        }
      }
      .app-icon {
        width: 48px;
        height: 48px;
        margin-bottom: 0.75rem;
        transition: all 0.3s ease;
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .app-icon svg {
        width: 32px;
        height: 32px;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.15));
        transition: all 0.3s ease;
      }

      .app-bubble:hover .app-icon svg {
        transform: scale(1.1);
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2)) brightness(1.1);
      }

      /* Fallback styling for emoji icons */
      .app-icon span {
        font-size: 2.5rem;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.15));
        transition: all 0.3s ease;
      }

      .app-bubble:hover .app-icon span {
        transform: scale(1.1);
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2)) brightness(1.1);
      }

      /* Icon entrance animation */
      .app-icon svg,
      .app-icon span {
        animation: iconFadeIn 0.6s ease-out;
      }

      @keyframes iconFadeIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Skeleton Loading Animation */
      .app-bubble.loading {
        animation: pulse 2s ease-in-out infinite;
      }

      .app-bubble.loading .app-icon,
      .app-bubble.loading .app-name {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: transparent;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }

      .app-name {
        font-size: 0.8rem;
        font-weight: 400;
        text-align: center;
        padding: 0 0.5rem;
        color: rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
        letter-spacing: 0.025em;
        line-height: 1.2;
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        backdrop-filter: blur(10px);
      }

      .modal-content {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(30px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
      }

      .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 2rem;
        cursor: pointer;
        padding: 0;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s ease;
      }

      .close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: white;
      }

      .form-input {
        width: 100%;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        color: white;
        font-size: 1rem;
        outline: none;
        transition: all 0.3s ease;
      }

      .form-input:focus {
        border-color: rgba(74, 144, 226, 0.8);
        background: rgba(74, 144, 226, 0.15);
        box-shadow: 0 0 20px rgba(74, 144, 226, 0.3);
      }

      .form-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .form-select {
        width: 100%;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        color: white;
        font-size: 1rem;
        outline: none;
        cursor: pointer;
      }

      .emoji-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 0.5rem;
        max-height: 200px;
        overflow-y: auto;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
      }

      .emoji-btn {
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid transparent;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.5rem;
        transition: all 0.2s ease;
      }

      .emoji-btn:hover,
      .emoji-btn.selected {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(74, 144, 226, 0.8);
        transform: scale(1.1);
      }

      .image-upload {
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .image-upload:hover {
        border-color: rgba(74, 144, 226, 0.8);
        background: rgba(74, 144, 226, 0.1);
      }

      .image-upload.dragover {
        border-color: rgba(34, 197, 94, 0.8);
        background: rgba(34, 197, 94, 0.1);
      }

      .image-preview {
        width: 80px;
        height: 80px;
        border-radius: 15px;
        object-fit: cover;
        margin: 0 auto 1rem;
        display: none;
      }

      .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      .btn {
        flex: 1;
        padding: 1rem 1.5rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .btn.primary {
        background: rgba(34, 197, 94, 0.3);
        border-color: rgba(34, 197, 94, 0.5);
      }

      .btn.primary:hover {
        background: rgba(34, 197, 94, 0.5);
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2.5rem;
        }

        .filter-container {
          gap: 0.5rem;
        }

        .filter-btn {
          padding: 0.5rem 1rem;
          font-size: 0.8rem;
        }

        .apps-container {
          padding: 1rem;
        }

        .apps-grid {
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
          gap: 1.5rem;
        }

        .app-bubble {
          width: 140px;
          height: 140px;
        }

        .app-icon {
          font-size: 2.5rem;
        }
      }

      @media (max-width: 480px) {
        .filter-container {
          gap: 0.4rem;
          padding: 0.5rem 1rem 2rem;
        }

        .filter-btn {
          padding: 0.4rem 0.8rem;
          font-size: 0.75rem;
        }

        .apps-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
        }

        .app-bubble {
          width: 120px;
          height: 120px;
        }

        .app-icon {
          font-size: 2rem;
        }

        .app-name {
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Elegant Mode Toggle -->
    <div class="mode-toggle-container">
      <button
        class="mode-toggle active"
        id="workToggle"
        onclick="toggleMode('work')"
        aria-label="Switch to Work Mode"
      >
        Work
      </button>
      <button
        class="mode-toggle"
        id="learnToggle"
        onclick="toggleMode('learn')"
        aria-label="Switch to Learn Mode"
      >
        Learn
      </button>
      <button
        class="mode-toggle"
        id="funToggle"
        onclick="toggleMode('fun')"
        aria-label="Switch to Fun Mode"
      >
        Play
      </button>
    </div>

    <!-- Favorites Toggle -->
    <button
      class="favorites-toggle"
      id="favoritesToggle"
      onclick="toggleFavoritesView()"
    >
      ‚òÖ Favorites
    </button>

    <div class="header">
      <h1>iowidgets</h1>
      <p>Your curated collection of essential tools</p>
      <div class="subtitle">
        Discover, collect, and organize your favorite productivity widgets
      </div>
    </div>

    <div class="search-container">
      <div class="search-wrapper">
        <span class="search-icon">‚åï</span>
        <input
          type="text"
          class="search-box"
          id="searchBox"
          placeholder="Find your perfect tool..."
        />
      </div>
    </div>

    <div class="filter-container">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="business">ÔøΩ Business</button>
      <button class="filter-btn" data-filter="technology">
        üíª Tech & Design
      </button>
      <button class="filter-btn" data-filter="wellness">
        ÔøΩ Health & Learning
      </button>
      <button class="filter-btn" data-filter="operations">‚ö° Operations</button>
    </div>

    <div class="apps-container" id="appsContainer">
      <div class="apps-grid" id="appsGrid"></div>
    </div>

    <!-- Elegant Notification -->
    <div class="notification" id="notification"></div>

    <script>
      // Professional SVG Icon Library
      const iconSVGs = {
        // Business Icons
        "expense-tracker": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>`,

        "budget-planner": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>`,

        "invoice-generator": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`,

        "currency-converter": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>`,

        "project-timer": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42A8.962 8.962 0 0 0 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9a8.994 8.994 0 0 0 7.03-14.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>`,

        "meeting-notes": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>`,

        "todo-manager": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 16.21v-.58c0-1.4-.65-2.26-1.96-2.26-.65 0-1.22.42-1.38 1.03-.25-.61-.86-1.03-1.54-1.03-.86 0-1.53.58-1.53 1.29 0 .27.06.53.18.74L17 18l1.23-2.6c.12-.21.18-.47.18-.74 0-.71-.67-1.29-1.53-1.29-.68 0-1.29.42-1.54 1.03-.16-.61-.73-1.03-1.38-1.03-1.31 0-1.96.86-1.96 2.26v.58L12 24l10-7.79z"/><path d="M9 16.2L6.8 14l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>`,

        // Technology Icons
        "code-formatter": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>`,

        "api-tester": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14.6 16.6l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4zm-5.2 0L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4z"/></svg>`,

        "regex-builder": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M12 10h-2v3h-3v2h3v3h2v-3h3v-2h-3z"/></svg>`,

        "json-formatter": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M5 3h2v2h2v2H7v2H5V7H3V5h2V3zm0 8h2v2h2v2H7v2H5v-2H3v-2h2v-2zm8-8h2v2h2v2h-2v2h-2V7h-2V5h2V3zm0 8h2v2h2v2h-2v2h-2v-2h-2v-2h2v-2z"/></svg>`,

        "color-picker": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>`,

        "password-generator": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>`,

        "qr-generator": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM19 13h2v2h-2zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM15 19h2v2h-2zM17 17h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2zM19 19h2v2h-2z"/></svg>`,

        // Wellness Icons
        "bmi-calculator": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 9V3.5L18.5 9M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6H6z"/></svg>`,

        "meditation-timer": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`,

        "study-planner": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/></svg>`,

        "habit-tracker": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`,

        flashcards: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>`,

        "meal-planner": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.20-1.10-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z"/></svg>`,

        // Operations Icons
        "inventory-tracker": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>`,

        "shift-scheduler": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>`,

        "route-planner": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>`,

        "safety-checklist": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/></svg>`,

        "equipment-logger": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>`,

        "cost-calculator": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm-8 8H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V7h2v2z"/></svg>`,

        // General Icons
        calculator: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm-8 8H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V7h2v2z"/></svg>`,

        stopwatch: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42A8.962 8.962 0 0 0 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9a8.994 8.994 0 0 0 7.03-14.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>`,

        "dice-roller": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M5 3H19C20.1 3 21 3.9 21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3M7 7H9V9H7V7M15 7H17V9H15V7M7 11H9V13H7V11M11 11H13V13H11V11M15 11H17V13H15V11M7 15H9V17H7V15M15 15H17V17H15V15Z"/></svg>`,

        "background-generator": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>`,
      };

      const defaultApps = [
        // BUSINESS CATEGORY - Embeddable Widgets for Business
        {
          id: "clock-widget",
          name: "Clock Widget",
          icon: "ÔøΩ",
          category: "business",
          url: "widgets/clock.html",
          builtin: true,
        },
        {
          id: "countdown-timer",
          name: "Countdown Timer",
          icon: "‚è±Ô∏è",
          category: "business",
          url: "widgets/countdown.html",
          builtin: true,
        },
        {
          id: "calculator-widget",
          name: "Calculator Widget",
          icon: "üßÆ",
          category: "business",
          url: "widgets/calculator.html",
          builtin: true,
        },
        {
          id: "contact-form",
          name: "Contact Form Builder",
          icon: "ÔøΩ",
          category: "business",
          url: "widgets/contact-form.html",
          builtin: true,
        },
        {
          id: "pricing-table",
          name: "Pricing Table",
          icon: "üí∞",
          category: "business",
          url: "widgets/pricing-table.html",
          builtin: true,
        },
        {
          id: "testimonial-slider",
          name: "Testimonial Slider",
          icon: "‚≠ê",
          category: "business",
          url: "#",
          builtin: true,
        },
        {
          id: "progress-bar",
          name: "Progress Bar",
          icon: "üìä",
          category: "business",
          url: "#",
          builtin: true,
        },

        // TECHNOLOGY CATEGORY - Design & Development Widgets
        {
          id: "color-picker",
          name: "Color Picker",
          icon: "üé®",
          category: "technology",
          url: "#",
          builtin: true,
        },
        {
          id: "qr-generator",
          name: "QR Code Generator",
          icon: "ÔøΩ",
          category: "technology",
          url: "#",
          builtin: true,
        },
        {
          id: "gradient-generator",
          name: "Gradient Generator",
          icon: "üåà",
          category: "technology",
          url: "#",
          builtin: true,
        },
        {
          id: "icon-library",
          name: "Icon Library",
          icon: "‚ú®",
          category: "technology",
          url: "#",
          builtin: true,
        },
        {
          id: "code-syntax",
          name: "Code Syntax Highlighter",
          icon: "üíª",
          category: "technology",
          url: "#",
          builtin: true,
        },
        {
          id: "image-slider",
          name: "Image Slider",
          icon: "ÔøΩÔ∏è",
          category: "technology",
          url: "#",
          builtin: true,
        },
        {
          id: "accordion-widget",
          name: "Accordion Widget",
          icon: "ÔøΩ",
          category: "technology",
          url: "#",
          builtin: true,
        },

        // WELLNESS CATEGORY - Health & Learning Widgets
        {
          id: "quote-widget",
          name: "Daily Quote Widget",
          icon: "üí≠",
          category: "wellness",
          url: "widgets/quote.html",
          builtin: true,
        },
        {
          id: "meditation-timer",
          name: "Meditation Timer",
          icon: "üßò‚Äç‚ôÄÔ∏è",
          category: "wellness",
          url: "#",
          builtin: true,
        },
        {
          id: "habit-tracker",
          name: "Habit Tracker",
          icon: "‚úì",
          category: "wellness",
          url: "#",
          builtin: true,
        },
        {
          id: "bmi-calculator",
          name: "BMI Calculator",
          icon: "‚öñÔ∏è",
          category: "wellness",
          url: "#",
          builtin: true,
        },
        {
          id: "language-practice",
          name: "Language Practice",
          icon: "üåç",
          category: "learn",
          url: "#",
          builtin: true,
        },

        // LEARN CATEGORY - Educational & Learning Widgets
        {
          id: "flashcards",
          name: "Flashcard Widget",
          icon: "ÔøΩ",
          category: "learn",
          url: "#",
          builtin: true,
        },
        {
          id: "quiz-widget",
          name: "Quiz Widget",
          icon: "‚ùì",
          category: "learn",
          url: "#",
          builtin: true,
        },
        {
          id: "typing-test",
          name: "Typing Speed Test",
          icon: "‚å®Ô∏è",
          category: "learn",
          url: "#",
          builtin: true,
        },
        {
          id: "math-practice",
          name: "Math Practice",
          icon: "ÔøΩ",
          category: "learn",
          url: "#",
          builtin: true,
        },
        {
          id: "language-widget",
          name: "Language Learning",
          icon: "ÔøΩ",
          category: "learn",
          url: "#",
          builtin: true,
        },
        {
          id: "study-timer",
          name: "Pomodoro Timer",
          icon: "üçÖ",
          category: "learn",
          url: "#",
          builtin: true,
        },

        // GENERAL/FUN - Fun & Interactive Widgets
        {
          id: "dice-roller",
          name: "Dice Roller",
          icon: "üé≤",
          category: "general",
          url: "#",
          builtin: true,
        },
        {
          id: "random-picker",
          name: "Random Name Picker",
          icon: "üéØ",
          category: "general",
          url: "#",
          builtin: true,
        },
        {
          id: "emoji-picker",
          name: "Emoji Picker",
          icon: "üòÄ",
          category: "general",
          url: "#",
          builtin: true,
        },
        {
          id: "trivia-widget",
          name: "Trivia Quiz",
          icon: "üß†",
          category: "general",
          url: "#",
          builtin: true,
        },
        {
          id: "weather-widget",
          name: "Weather Widget",
          icon: "üå§Ô∏è",
          category: "general",
          url: "#",
          builtin: true,
        },
        {
          id: "music-player",
          name: "Audio Player",
          icon: "üéµ",
          category: "general",
          url: "#",
          builtin: true,
        },
      ];
      let apps = [...defaultApps];
      let customApps = JSON.parse(
        localStorage.getItem("iowidgets-custom") || "[]"
      );
      apps = [...defaultApps, ...customApps];

      // Work/Learn/Fun Mode Categories
      let currentMode = "work";
      const workCategories = ["business", "technology", "operations"];
      const learnCategories = ["learn", "wellness"];
      const funCategories = ["general"];

      // Favorites system
      let favorites = JSON.parse(
        localStorage.getItem("iowidgets-favorites") || "[]"
      );
      let showingFavoritesOnly = false;

      const container = document.getElementById("appsContainer");
      const grid = document.getElementById("appsGrid");
      let currentFilter = "all";
      let searchTerm = "";

      const emojis = [
        "üì±",
        "üíª",
        "üñ•Ô∏è",
        "‚åö",
        "üì∑",
        "üéÆ",
        "üïπÔ∏è",
        "üéµ",
        "üé¨",
        "üì∫",
        "üé®",
        "‚úèÔ∏è",
        "üìù",
        "üìä",
        "üìà",
        "üßÆ",
        "‚è∞",
        "‚è±Ô∏è",
        "‚è≤Ô∏è",
        "üìÖ",
        "üîß",
        "‚öôÔ∏è",
        "üî®",
        "üõ†Ô∏è",
        "‚öñÔ∏è",
        "üîç",
        "üîê",
        "üóùÔ∏è",
        "üîí",
        "üîì",
        "üí°",
        "üîã",
        "üì°",
        "üì∂",
        "üíæ",
        "üíø",
        "üìÄ",
        "üíΩ",
        "üñ®Ô∏è",
        "üì†",
        "‚òÅÔ∏è",
        "üåê",
        "üåç",
        "üó∫Ô∏è",
        "üß≠",
        "‚≠ê",
        "üåü",
        "‚ú®",
        "üí´",
        "üîÆ",
        "üéØ",
        "üèÜ",
        "ü•á",
        "üèÖ",
        "üéóÔ∏è",
        "üéñÔ∏è",
        "üèµÔ∏è",
        "üéÄ",
        "üéÅ",
        "üéä",
      ];

      // Sort apps by category for better organization
      const categoryOrder = [
        "business",
        "technology",
        "wellness",
        "operations",
        "general",
      ];

      function createBubble(app, index) {
        const bubble = document.createElement("div");
        const isFavorited = favorites.includes(app.id);
        bubble.className = `app-bubble category-${app.category}${
          app.backgroundImage ? " has-image" : ""
        }${!app.builtin ? " custom" : ""}${isFavorited ? " favorited" : ""}`;
        bubble.dataset.category = app.category;
        bubble.dataset.appId = app.id;

        if (app.backgroundImage) {
          bubble.style.backgroundImage = `url(${app.backgroundImage})`;
        }

        const favoriteIcon = isFavorited ? "‚ô•" : "‚ô°";
        const favoriteClass = isFavorited ? "favorited" : "";

        // Use SVG icon if available, fallback to emoji
        const iconContent =
          iconSVGs[app.id] ||
          `<span style="font-size: 2.5rem;">${app.icon}</span>`;

        bubble.innerHTML = `
          <div class="favorite-heart ${favoriteClass}" onclick="toggleFavorite('${app.id}')" title="Add to favorites">
            ${favoriteIcon}
          </div>
          <div class="app-icon">${iconContent}</div>
          <div class="app-name">${app.name}</div>
        `;

        // Add accessibility attributes
        bubble.setAttribute("tabindex", "0");
        bubble.setAttribute("role", "button");
        bubble.setAttribute("aria-label", `Open ${app.name} app`);

        // Add gentle floating animation with staggered delay
        bubble.style.animation = `gentleFloat ${
          6 + Math.random() * 2
        }s ease-in-out infinite`;
        bubble.style.animationDelay = `${index * 0.1 + Math.random() * 0.5}s`;

        const handleAppActivation = (e) => {
          if (e.target.closest(".app-actions")) return;

          // Add click feedback
          bubble.style.transform = "scale(0.95)";
          console.log(
            `Attempting to open app: ${app.name} with URL: ${app.url}`
          );

          setTimeout(() => {
            bubble.style.transform = "";
            if (app.url !== "#") {
              // Add error handling for broken links
              try {
                console.log(`Opening ${app.name} in new window...`);
                const newWindow = window.open(
                  app.url,
                  "_blank",
                  "noopener,noreferrer"
                );
                if (
                  !newWindow ||
                  newWindow.closed ||
                  typeof newWindow.closed == "undefined"
                ) {
                  console.error("Window was blocked or failed to open");
                  showNotification(
                    `Could not open ${app.name}. Check if popup blocker is enabled.`,
                    "error"
                  );
                } else {
                  console.log(`Successfully opened ${app.name}`);
                  showNotification(`Opening ${app.name}...`, "success");
                }
              } catch (error) {
                console.error("Error opening app:", error);
                showNotification(
                  `Error opening ${app.name}. Please try again.`,
                  "error"
                );
              }
            } else {
              console.log(`${app.name} is marked as coming soon`);
              showNotification(`${app.name} - Coming Soon!`, "error");
            }
          }, 150);
        };

        // Improve click handling with better event delegation
        bubble.addEventListener("click", (e) => {
          console.log(
            "Bubble clicked:",
            e.target,
            e.target.closest(".app-actions")
          );

          // Check if click is on action buttons
          if (e.target.closest(".app-actions")) {
            console.log("Click on action button, not opening app");
            e.stopPropagation();
            return;
          }

          // Stop event bubbling to prevent conflicts
          e.stopPropagation();
          handleAppActivation(e);
        });

        bubble.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            e.stopPropagation();
            handleAppActivation(e);
          }
        });

        // Add touch event handling for mobile
        bubble.addEventListener("touchstart", (e) => {
          bubble.style.transform = "scale(0.95)";
        });

        bubble.addEventListener("touchend", (e) => {
          setTimeout(() => {
            bubble.style.transform = "";
          }, 150);
        });

        return bubble;
      }

      function displayApps() {
        let filteredApps = apps;

        // Filter by work/learn/fun mode first
        let availableCategories;
        if (currentMode === "work") {
          availableCategories = workCategories;
        } else if (currentMode === "learn") {
          availableCategories = learnCategories;
        } else {
          availableCategories = funCategories;
        }
        filteredApps = apps.filter((app) =>
          availableCategories.includes(app.category)
        );

        // Filter by favorites
        if (showingFavoritesOnly) {
          filteredApps = filteredApps.filter((app) =>
            favorites.includes(app.id)
          );
        }

        // Filter by category
        if (currentFilter !== "all") {
          filteredApps = filteredApps.filter(
            (app) => app.category === currentFilter
          );
        }

        // Filter by search term
        if (searchTerm) {
          filteredApps = filteredApps.filter((app) =>
            app.name.toLowerCase().includes(searchTerm.toLowerCase())
          );
        }

        // Sort apps
        filteredApps.sort((a, b) => {
          const aIndex = categoryOrder.indexOf(a.category);
          const bIndex = categoryOrder.indexOf(b.category);
          if (aIndex === bIndex) {
            return a.name.localeCompare(b.name);
          }
          return aIndex - bIndex;
        });

        // Clear the grid
        grid.innerHTML = "";

        if (filteredApps.length === 0) {
          grid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 4rem 2rem; opacity: 0.7;">
              <h3>No apps found</h3>
              <p>Try adjusting your search or filters</p>
            </div>
          `;
          return;
        }

        // Create and add bubbles with staggered animation
        filteredApps.forEach((app, index) => {
          const bubble = createBubble(app, index);
          grid.appendChild(bubble);

          // Animate in with delay
          setTimeout(() => {
            bubble.classList.add("visible");
          }, index * 50);
        });
      }

      // App Management Functions
      function saveApps() {
        const customOnly = apps.filter((app) => !app.builtin);
        localStorage.setItem("iowidgets-custom", JSON.stringify(customOnly));
      }

      function generateId() {
        return (
          "app_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9)
        );
      }

      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      // Favorites Functions
      function saveFavorites() {
        localStorage.setItem("iowidgets-favorites", JSON.stringify(favorites));
      }

      function toggleFavorite(appId) {
        const index = favorites.indexOf(appId);
        if (index > -1) {
          favorites.splice(index, 1);
          showNotification("Removed from favorites", "success");
        } else {
          favorites.push(appId);
          showNotification("Added to favorites", "success");
        }
        saveFavorites();
        displayApps();
      }

      function toggleFavoritesView() {
        showingFavoritesOnly = !showingFavoritesOnly;
        const button = document.getElementById("favoritesToggle");

        if (showingFavoritesOnly) {
          button.textContent = "‚Üê All Widgets";
          button.classList.add("active");

          // Reset other filters when showing favorites
          currentFilter = "all";
          searchTerm = "";
          document.getElementById("searchBox").value = "";
          document.querySelectorAll(".filter-btn").forEach((btn) => {
            btn.classList.remove("active");
            if (btn.dataset.filter === "all") {
              btn.classList.add("active");
            }
          });

          showNotification(
            `${favorites.length} favorites in your collection`,
            "success"
          );
        } else {
          button.textContent = "‚òÖ Favorites";
          button.classList.remove("active");
          showNotification("Browse all available widgets", "success");
        }

        displayApps();
      }

      function deleteApp(id) {
        const app = apps.find((a) => a.id === id);
        if (!app || app.builtin) return;

        if (confirm(`Delete "${app.name}"?`)) {
          apps = apps.filter((a) => a.id !== id);
          // Also remove from favorites if it was favorited
          const favIndex = favorites.indexOf(id);
          if (favIndex > -1) {
            favorites.splice(favIndex, 1);
            saveFavorites();
          }
          saveApps();
          displayApps();
          showNotification("App deleted successfully");
        }
      }

      // Search functionality
      document.getElementById("searchBox").addEventListener("input", (e) => {
        searchTerm = e.target.value.trim();
        displayApps();
      });

      // Filter functionality
      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          // Update active button
          document
            .querySelectorAll(".filter-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          // Update filter and refresh display
          currentFilter = btn.dataset.filter;

          // Add transition effect
          const bubbles = document.querySelectorAll(".app-bubble");
          bubbles.forEach((bubble, index) => {
            bubble.style.transition = "all 0.3s ease";
            bubble.style.transform = "translateY(20px) scale(0.8)";
            bubble.style.opacity = "0";
          });

          setTimeout(() => {
            displayApps();
          }, 300);
        });
      });

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey || e.metaKey) {
          if (e.key === "f") {
            e.preventDefault();
            toggleFavoritesView();
          }
        }
      });

      // Responsive handling
      window.addEventListener("resize", () => {
        // Small delay to ensure proper recalculation
        setTimeout(displayApps, 100);
      });

      // Work/Fun Mode Functions
      function toggleMode(mode) {
        currentMode = mode;

        // Update corner toggle states
        document
          .getElementById("workToggle")
          .classList.toggle("active", mode === "work");
        document
          .getElementById("learnToggle")
          .classList.toggle("active", mode === "learn");
        document
          .getElementById("funToggle")
          .classList.toggle("active", mode === "fun");

        // Update body class for background
        document.body.classList.toggle("fun-mode", mode === "fun");
        document.body.classList.toggle("learn-mode", mode === "learn");

        // Filter apps based on mode
        let availableCategories;
        if (mode === "work") {
          availableCategories = workCategories;
        } else if (mode === "learn") {
          availableCategories = learnCategories;
        } else {
          availableCategories = funCategories;
        }

        // Reset filters when switching modes
        currentFilter = "all";
        searchTerm = "";
        showingFavoritesOnly = false;

        // Update UI
        document.getElementById("searchBox").value = "";
        document.getElementById("favoritesToggle").textContent = "‚òÖ Favorites";
        document.getElementById("favoritesToggle").classList.remove("active");

        // Update filter buttons
        updateFilterButtons(availableCategories);

        displayApps();

        // Count apps in this mode
        const modeApps = apps.filter((app) =>
          availableCategories.includes(app.category)
        );
        showNotification(
          `${mode.toUpperCase()} Mode ‚Ä¢ ${modeApps.length} apps available`,
          "success"
        );
      }

      function updateFilterButtons(availableCategories) {
        const filterContainer = document.querySelector(".filter-container");
        const allBtn =
          '<button class="filter-btn active" data-filter="all">All</button>';

        if (currentMode === "work") {
          filterContainer.innerHTML =
            allBtn +
            `
            <button class="filter-btn" data-filter="business">ÔøΩ Business</button>
            <button class="filter-btn" data-filter="technology">üíª Tech & Design</button>
            <button class="filter-btn" data-filter="wellness">ÔøΩ Health & Learning</button>
            <button class="filter-btn" data-filter="operations">‚ö° Operations</button>
          `;
        } else if (currentMode === "learn") {
          filterContainer.innerHTML =
            allBtn +
            `
            <button class="filter-btn" data-filter="learn">üìö Learning</button>
            <button class="filter-btn" data-filter="wellness">üå± Health & Wellness</button>
          `;
        } else {
          filterContainer.innerHTML =
            allBtn +
            `
            <button class="filter-btn" data-filter="games">üéÆ Games</button>
            <button class="filter-btn" data-filter="entertainment">üé¨ Entertainment</button>
            <button class="filter-btn" data-filter="social">üí¨ Social</button>
            <button class="filter-btn" data-filter="creative">üé® Creative</button>
            <button class="filter-btn" data-filter="general">üîß General</button>
          `;
        }

        // Re-attach event listeners
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            currentFilter = btn.dataset.filter;

            const bubbles = document.querySelectorAll(".app-bubble");
            bubbles.forEach((bubble, index) => {
              bubble.style.transition = "all 0.3s ease";
              bubble.style.transform = "translateY(20px) scale(0.8)";
              bubble.style.opacity = "0";
            });

            setTimeout(() => {
              displayApps();
            }, 300);
          });
        });
      }

      // Window focus event to refresh background when returning from apps
      window.addEventListener("focus", () => {
        // Force repaint to prevent black screen
        document.body.style.transform = "translateZ(0)";
        setTimeout(() => {
          document.body.style.transform = "";
        }, 10);
      });

      // Page visibility API to handle background refresh
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) {
          // Refresh background when page becomes visible
          document.body.style.willChange = "background";
          setTimeout(() => {
            document.body.style.willChange = "auto";
          }, 100);
        }
      });

      // Advanced Keyboard Navigation System
      let searchIndex = -1;
      let keyboardMode = false;

      // Create shortcuts hint element
      const shortcutsHint = document.createElement("div");
      shortcutsHint.className = "shortcuts-hint";
      shortcutsHint.innerHTML = `
        <kbd>/</kbd> Focus search ‚Ä¢ <kbd>‚Üë</kbd><kbd>‚Üì</kbd> Navigate ‚Ä¢ <kbd>Enter</kbd> Open ‚Ä¢ <kbd>M</kbd> Toggle mode ‚Ä¢ <kbd>Esc</kbd> Clear
      `;
      document.body.appendChild(shortcutsHint);

      // Show keyboard hints briefly on load
      setTimeout(() => {
        shortcutsHint.classList.add("show");
        setTimeout(() => shortcutsHint.classList.remove("show"), 3500);
      }, 1000);

      document.addEventListener("keydown", (e) => {
        const visibleBubbles = Array.from(
          document.querySelectorAll(".app-bubble")
        ).filter((b) => b.style.display !== "none" && b.style.opacity !== "0");

        switch (e.key) {
          case "/":
            if (document.activeElement.tagName !== "INPUT") {
              e.preventDefault();
              document.getElementById("searchBox").focus();
              shortcutsHint.classList.add("show");
              setTimeout(() => shortcutsHint.classList.remove("show"), 2500);
            }
            break;

          case "ArrowDown":
            if (keyboardMode || document.activeElement.id === "searchBox") {
              e.preventDefault();
              keyboardMode = true;
              searchIndex = Math.min(
                searchIndex + 1,
                visibleBubbles.length - 1
              );
              updateKeyboardSelection(visibleBubbles);
            }
            break;

          case "ArrowUp":
            if (keyboardMode || searchIndex >= 0) {
              e.preventDefault();
              keyboardMode = true;
              searchIndex = Math.max(searchIndex - 1, -1);
              updateKeyboardSelection(visibleBubbles);
              if (searchIndex === -1) {
                document.getElementById("searchBox").focus();
                keyboardMode = false;
              }
            }
            break;

          case "Enter":
            if (searchIndex >= 0 && visibleBubbles[searchIndex]) {
              e.preventDefault();
              visibleBubbles[searchIndex].click();
            }
            break;

          case "m":
          case "M":
            if (document.activeElement.tagName !== "INPUT") {
              e.preventDefault();
              const currentModeButton = document.querySelector(
                ".mode-toggle .active"
              );
              let nextMode;
              if (currentModeButton.id === "workToggle") {
                nextMode = "learn";
              } else if (currentModeButton.id === "learnToggle") {
                nextMode = "fun";
              } else {
                nextMode = "work";
              }
              toggleMode(nextMode);
              shortcutsHint.classList.add("show");
              setTimeout(() => shortcutsHint.classList.remove("show"), 2000);
            }
            break;

          case "f":
          case "F":
            if (
              document.activeElement.tagName !== "INPUT" &&
              !e.ctrlKey &&
              !e.metaKey
            ) {
              e.preventDefault();
              document.getElementById("favoritesToggle").click();
              shortcutsHint.classList.add("show");
              setTimeout(() => shortcutsHint.classList.remove("show"), 2000);
            }
            break;

          case "Escape":
            e.preventDefault();
            const searchBox = document.getElementById("searchBox");
            searchBox.value = "";
            searchBox.dispatchEvent(new Event("input"));
            searchBox.blur();
            searchIndex = -1;
            keyboardMode = false;
            updateKeyboardSelection(visibleBubbles);
            break;

          case "1":
          case "2":
          case "3":
          case "4":
          case "5":
            if (document.activeElement.tagName !== "INPUT") {
              e.preventDefault();
              const filterBtns = document.querySelectorAll(".filter-btn");
              const index = parseInt(e.key) - 1;
              if (filterBtns[index]) {
                filterBtns[index].click();
                shortcutsHint.classList.add("show");
                setTimeout(() => shortcutsHint.classList.remove("show"), 2000);
              }
            }
            break;
        }
      });

      function updateKeyboardSelection(bubbles) {
        // Remove previous selection
        document
          .querySelectorAll(".app-bubble.keyboard-selected")
          .forEach((b) => {
            b.classList.remove("keyboard-selected");
          });

        // Add current selection with enhanced visual feedback
        if (searchIndex >= 0 && bubbles[searchIndex]) {
          const selectedBubble = bubbles[searchIndex];
          selectedBubble.classList.add("keyboard-selected");
          selectedBubble.scrollIntoView({
            block: "center",
            behavior: "smooth",
            inline: "center",
          });

          // Add subtle pulse animation
          selectedBubble.style.animation = "pulse 1.5s ease-in-out infinite";
        } else {
          // Clear animations when no selection
          bubbles.forEach((b) => {
            b.style.animation = "";
          });
        }
      }

      // Reset keyboard navigation on mouse interaction
      document.addEventListener("mousemove", () => {
        if (keyboardMode) {
          keyboardMode = false;
          searchIndex = -1;
          updateKeyboardSelection([]);
        }
      });

      // PWA Installation & Offline Support
      let deferredPrompt;
      let isInstalled = false;

      // Check if app is already installed
      if (window.matchMedia("(display-mode: standalone)").matches) {
        isInstalled = true;
      }

      // Create install button
      const installBtn = document.createElement("button");
      installBtn.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
        </svg>
        Install App
      `;
      installBtn.style.cssText = `
        position: fixed;
        top: 1rem;
        left: 1rem;
        background: rgba(74, 144, 226, 0.9);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        display: none;
        align-items: center;
        gap: 0.5rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        z-index: 1001;
      `;

      installBtn.addEventListener("mouseenter", () => {
        installBtn.style.background = "rgba(74, 144, 226, 1)";
        installBtn.style.transform = "translateY(-2px)";
      });

      installBtn.addEventListener("mouseleave", () => {
        installBtn.style.background = "rgba(74, 144, 226, 0.9)";
        installBtn.style.transform = "translateY(0)";
      });

      if (!isInstalled) {
        document.body.appendChild(installBtn);
      }

      // Listen for beforeinstallprompt event
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        if (!isInstalled) {
          installBtn.style.display = "flex";
        }
      });

      // Handle install button click
      installBtn.addEventListener("click", async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;

          if (outcome === "accepted") {
            showNotification("App installed successfully! üéâ", "success");
            installBtn.style.display = "none";
          }

          deferredPrompt = null;
        }
      });

      // Register service worker for offline functionality
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", async () => {
          try {
            const registration = await navigator.serviceWorker.register(
              "/sw.js"
            );
            console.log("ServiceWorker registered:", registration);

            // Check for updates
            registration.addEventListener("updatefound", () => {
              const newWorker = registration.installing;
              newWorker.addEventListener("statechange", () => {
                if (
                  newWorker.state === "installed" &&
                  navigator.serviceWorker.controller
                ) {
                  showNotification(
                    "New version available! Refresh to update.",
                    "info"
                  );
                }
              });
            });
          } catch (error) {
            console.log("ServiceWorker registration failed:", error);
          }
        });
      }

      // Smart App Recommendations System
      class AppRecommendations {
        constructor() {
          this.usage = JSON.parse(localStorage.getItem("appUsage") || "{}");
          this.preferences = JSON.parse(
            localStorage.getItem("userPreferences") || "{}"
          );
          this.timePatterns = JSON.parse(
            localStorage.getItem("timePatterns") || "{}"
          );
        }

        trackUsage(appName) {
          const now = new Date();
          const hour = now.getHours();
          const day = now.getDay();

          if (!this.usage[appName]) {
            this.usage[appName] = { count: 0, lastUsed: 0, timePattern: {} };
          }

          this.usage[appName].count++;
          this.usage[appName].lastUsed = Date.now();

          // Track time patterns
          const timeKey = `${day}-${hour}`;
          if (!this.usage[appName].timePattern[timeKey]) {
            this.usage[appName].timePattern[timeKey] = 0;
          }
          this.usage[appName].timePattern[timeKey]++;

          this.saveData();
        }

        getRecommendations() {
          const now = new Date();
          const hour = now.getHours();
          const day = now.getDay();
          const timeKey = `${day}-${hour}`;

          // Time-based recommendations
          let recommendations = [];

          if (hour >= 9 && hour <= 17) {
            // Work hours
            recommendations = apps.filter((app) =>
              ["business", "technology", "operations"].includes(app.category)
            );
          } else if (hour >= 18 && hour <= 22) {
            // Evening learning time
            recommendations = apps.filter((app) =>
              ["learn", "wellness"].includes(app.category)
            );
          } else {
            // Personal/fun time
            recommendations = apps.filter((app) =>
              ["wellness", "general", "entertainment"].includes(app.category)
            );
          }

          // Add usage-based recommendations
          const sortedByUsage = Object.entries(this.usage)
            .sort(([, a], [, b]) => b.count - a.count)
            .slice(0, 3)
            .map(([name]) => apps.find((app) => app.name === name))
            .filter(Boolean);

          // Add time pattern recommendations
          const timeBasedApps = Object.entries(this.usage)
            .filter(([, data]) => data.timePattern[timeKey] > 0)
            .sort(
              ([, a], [, b]) =>
                (b.timePattern[timeKey] || 0) - (a.timePattern[timeKey] || 0)
            )
            .slice(0, 2)
            .map(([name]) => apps.find((app) => app.name === name))
            .filter(Boolean);

          // Combine and deduplicate
          const combined = [
            ...recommendations,
            ...sortedByUsage,
            ...timeBasedApps,
          ];
          const unique = combined.filter(
            (app, index, self) =>
              index === self.findIndex((a) => a.name === app.name)
          );

          return unique.slice(0, 4);
        }

        saveData() {
          localStorage.setItem("appUsage", JSON.stringify(this.usage));
        }
      }

      const recommendations = new AppRecommendations();

      // Create recommendations section
      function createRecommendationsSection() {
        const recommended = recommendations.getRecommendations();
        if (recommended.length === 0) return "";

        return `
          <div class="recommendations-section">
            <div class="section-header">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9 17 14 18.18 21 12 17.77 5.82 21 7 14 2 9 8.91 8.26 12 2"/>
              </svg>
              <h3>Recommended for You</h3>
            </div>
            <div class="recommendations-grid">
              ${recommended
                .map(
                  (app) => `
                <div class="recommendation-item" data-app="${app.name}">
                  <div class="rec-icon">${iconSVGs[app.icon] || "üîß"}</div>
                  <div class="rec-info">
                    <div class="rec-name">${app.name}</div>
                    <div class="rec-reason">${getRecommendationReason(
                      app
                    )}</div>
                  </div>
                </div>
              `
                )
                .join("")}
            </div>
          </div>
        `;
      }

      function getRecommendationReason(app) {
        const usage = recommendations.usage[app.name];
        const now = new Date();
        const hour = now.getHours();

        if (usage && usage.count > 5) {
          return "Frequently used";
        } else if (
          hour >= 9 &&
          hour <= 17 &&
          ["business", "technology", "operations"].includes(app.category)
        ) {
          return "Perfect for work time";
        } else if (
          hour >= 18 &&
          hour <= 22 &&
          ["learn", "wellness"].includes(app.category)
        ) {
          return "Great for learning";
        } else if (
          (hour >= 23 || hour <= 8) &&
          ["wellness", "general"].includes(app.category)
        ) {
          return "Perfect for downtime";
        } else {
          return "Trending now";
        }
      }

      // Add recommendations CSS
      const recommendationsCSS = `
        .recommendations-section {
          margin-bottom: 2rem;
          padding: 1.5rem;
          background: rgba(255, 255, 255, 0.08);
          border-radius: 20px;
          border: 1px solid rgba(255, 255, 255, 0.12);
          backdrop-filter: blur(20px);
        }

        .section-header {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          margin-bottom: 1rem;
          color: rgba(255, 255, 255, 0.9);
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.1rem;
          font-weight: 600;
        }

        .recommendations-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 1rem;
        }

        .recommendation-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: rgba(255, 255, 255, 0.05);
          border-radius: 15px;
          border: 1px solid rgba(255, 255, 255, 0.1);
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .recommendation-item:hover {
          background: rgba(255, 255, 255, 0.1);
          transform: translateY(-2px);
          border-color: rgba(74, 144, 226, 0.5);
        }

        .rec-icon {
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(74, 144, 226, 0.2);
          border-radius: 12px;
          color: rgba(74, 144, 226, 1);
          font-size: 1.2rem;
        }

        .rec-info {
          flex: 1;
        }

        .rec-name {
          font-weight: 600;
          color: white;
          margin-bottom: 0.25rem;
        }

        .rec-reason {
          font-size: 0.8rem;
          color: rgba(255, 255, 255, 0.6);
        }

        @media (max-width: 768px) {
          .recommendations-grid {
            grid-template-columns: 1fr;
          }

          .recommendation-item {
            padding: 0.75rem;
          }
        }
      `;

      // Add CSS to head
      const style = document.createElement("style");
      style.textContent = recommendationsCSS;
      document.head.appendChild(style);

      // Recommendations functionality will be re-implemented later
      // For now, just use the original displayApps to fix the issue

      // App usage tracking will be re-implemented later

      // Initialize the app
      displayApps();
    </script>
  </body>
</html>
