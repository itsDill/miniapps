<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Advanced Unit Converter - Convert Length, Weight, Temperature & More |
      iowidgets
    </title>
    <meta
      name="description"
      content="Professional unit converter supporting 10+ categories: length, weight, temperature, volume, area, speed, time, pressure, energy, and data storage. Real-time conversion with history tracking and export options."
    />
    <meta
      name="keywords"
      content="unit converter, length converter, weight converter, temperature converter, metric converter, imperial converter, volume converter, area converter, measurement converter, conversion calculator"
    />
    <link
      rel="canonical"
      href="https://iowidgets.com/widgets/unit-converter.html"
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Advanced Unit Converter - Multi-Category Measurement Tool"
    />
    <meta
      property="og:description"
      content="Convert between 10+ unit categories including length, weight, temperature, volume, area, speed, time, pressure, energy, and data storage. Real-time conversion with history."
    />
    <meta
      property="og:url"
      content="https://iowidgets.com/widgets/unit-converter.html"
    />
    <meta
      property="og:image"
      content="https://iowidgets.com/assets/og-unit-converter.png"
    />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Advanced Unit Converter - Multi-Category Tool"
    />
    <meta
      name="twitter:description"
      content="Convert between multiple unit categories with real-time calculation, conversion history, and export options. Support for metric and imperial systems."
    />
    <meta
      name="twitter:image"
      content="https://iowidgets.com/assets/og-unit-converter.png"
    />

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Advanced Unit Converter",
        "description": "Professional unit converter supporting 10+ measurement categories",
        "url": "https://iowidgets.com/widgets/unit-converter.html",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "10+ conversion categories",
          "Real-time conversion",
          "Bi-directional conversion",
          "Conversion history tracking",
          "Export to CSV/JSON",
          "Common conversions",
          "Swap units instantly",
          "5 color themes",
          "Keyboard shortcuts",
          "Favorites system"
        ]
      }
    </script>
    <style>
      :root {
        --primary: #f093fb;
        --primary-dark: #d87be6;
        --primary-light: #f5acff;
        --secondary: #f5576c;
        --background: #ffffff;
        --surface: #f8f9fa;
        --text-primary: #1a1a1a;
        --text-secondary: #666666;
        --border: #e0e0e0;
        --shadow: rgba(0, 0, 0, 0.1);
        --shadow-lg: rgba(0, 0, 0, 0.2);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #3b82f6;

        --spacing-xs: 0.5rem;
        --spacing-sm: 0.75rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;

        --font-size-xs: clamp(0.75rem, 2vw, 0.875rem);
        --font-size-sm: clamp(0.875rem, 2.5vw, 0.9375rem);
        --font-size-base: clamp(1rem, 3vw, 1.125rem);
        --font-size-lg: clamp(1.125rem, 3.5vw, 1.25rem);
        --font-size-xl: clamp(1.25rem, 4vw, 1.5rem);
        --font-size-2xl: clamp(1.5rem, 5vw, 2rem);
        --font-size-3xl: clamp(2rem, 6vw, 2.5rem);

        --radius-sm: 0.5rem;
        --radius-md: 0.75rem;
        --radius-lg: 1rem;
        --radius-xl: 1.5rem;

        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      [data-theme="blue"] {
        --primary: #3b82f6;
        --primary-dark: #2563eb;
        --primary-light: #60a5fa;
        --secondary: #93c5fd;
      }

      [data-theme="green"] {
        --primary: #10b981;
        --primary-dark: #059669;
        --primary-light: #34d399;
        --secondary: #6ee7b7;
      }

      [data-theme="purple"] {
        --primary: #a855f7;
        --primary-dark: #9333ea;
        --primary-light: #c084fc;
        --secondary: #d8b4fe;
      }

      [data-theme="orange"] {
        --primary: #f97316;
        --primary-dark: #ea580c;
        --primary-light: #fb923c;
        --secondary: #fdba74;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-md);
        color: var(--text-primary);
        line-height: 1.6;
        transition: var(--transition);
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        box-shadow: 0 20px 60px var(--shadow-lg),
          0 0 0 1px rgba(255, 255, 255, 0.5);
        max-width: 600px;
        width: 100%;
        animation: slideUp 0.5s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
        gap: var(--spacing-md);
      }

      h1 {
        font-size: var(--font-size-2xl);
        color: var(--text-primary);
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .theme-selector {
        display: flex;
        gap: var(--spacing-xs);
        flex-wrap: wrap;
      }

      .theme-btn {
        width: 44px;
        height: 44px;
        border: 2px solid transparent;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition);
        background: var(--color);
        position: relative;
      }

      .theme-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .theme-btn.active {
        border-color: var(--text-primary);
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
      }

      .theme-btn:focus-visible {
        outline: 3px solid var(--primary);
        outline-offset: 2px;
      }

      .theme-btn[data-theme="pink"] {
        --color: #f093fb;
      }
      .theme-btn[data-theme="blue"] {
        --color: #3b82f6;
      }
      .theme-btn[data-theme="green"] {
        --color: #10b981;
      }
      .theme-btn[data-theme="purple"] {
        --color: #a855f7;
      }
      .theme-btn[data-theme="orange"] {
        --color: #f97316;
      }

      .form-group {
        margin-bottom: var(--spacing-lg);
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: var(--spacing-sm);
        color: var(--text-secondary);
        font-size: var(--font-size-sm);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      input,
      select {
        width: 100%;
        min-height: 44px;
        padding: var(--spacing-md);
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        font-size: var(--font-size-base);
        font-family: inherit;
        transition: var(--transition);
        background: white;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(240, 147, 251, 0.1);
      }

      input[type="number"] {
        font-variant-numeric: tabular-nums;
        font-weight: 600;
        color: var(--text-primary);
      }

      select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 40px;
      }

      .converter-section {
        background: var(--surface);
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        margin-bottom: var(--spacing-lg);
        border: 2px solid var(--border);
      }

      .swap-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: var(--spacing-md) auto;
        width: 44px;
        height: 44px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
        font-size: var(--font-size-xl);
      }

      .swap-btn:hover {
        background: var(--primary-dark);
        transform: rotate(180deg) scale(1.1);
      }

      .swap-btn:focus-visible {
        outline: 3px solid var(--primary-light);
        outline-offset: 2px;
      }

      .result {
        background: linear-gradient(
          135deg,
          var(--surface) 0%,
          rgba(240, 147, 251, 0.1) 100%
        );
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        text-align: center;
        margin-bottom: var(--spacing-lg);
        border: 2px solid var(--border);
      }

      .result-value {
        font-size: var(--font-size-3xl);
        font-weight: 700;
        color: var(--primary);
        margin-bottom: var(--spacing-xs);
        font-variant-numeric: tabular-nums;
        word-break: break-all;
      }

      .result-label {
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .tabs {
        display: flex;
        gap: var(--spacing-xs);
        margin-bottom: var(--spacing-lg);
        border-bottom: 2px solid var(--border);
        overflow-x: auto;
      }

      .tab {
        padding: var(--spacing-sm) var(--spacing-md);
        min-height: 44px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: var(--font-size-sm);
        font-weight: 600;
        color: var(--text-secondary);
        transition: var(--transition);
        white-space: nowrap;
      }

      .tab:hover {
        color: var(--primary);
      }

      .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
      }

      .tab:focus-visible {
        outline: 3px solid var(--primary);
        outline-offset: 2px;
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.3s ease-out;
      }

      .tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .common-conversions {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: var(--spacing-sm);
      }

      .common-btn {
        padding: var(--spacing-md);
        background: var(--surface);
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition);
        text-align: left;
        min-height: 44px;
      }

      .common-btn:hover {
        border-color: var(--primary);
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .common-btn:focus-visible {
        outline: 3px solid var(--primary);
        outline-offset: 2px;
      }

      .common-btn-label {
        font-size: var(--font-size-sm);
        color: var(--text-primary);
        font-weight: 600;
        display: block;
      }

      .common-btn-desc {
        font-size: var(--font-size-xs);
        color: var(--text-secondary);
        margin-top: var(--spacing-xs);
      }

      .history-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
        max-height: 400px;
        overflow-y: auto;
      }

      .history-item {
        background: var(--surface);
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        border: 2px solid var(--border);
        transition: var(--transition);
        cursor: pointer;
      }

      .history-item:hover {
        border-color: var(--primary);
        background: white;
      }

      .history-date {
        font-size: var(--font-size-xs);
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
      }

      .history-conversion {
        font-size: var(--font-size-sm);
        color: var(--text-primary);
        font-weight: 600;
      }

      .btn {
        min-width: 44px;
        min-height: 44px;
        padding: var(--spacing-md) var(--spacing-lg);
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-size: var(--font-size-sm);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        white-space: nowrap;
      }

      .btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:focus-visible {
        outline: 3px solid var(--primary-light);
        outline-offset: 2px;
      }

      .btn-secondary {
        background: var(--surface);
        color: var(--text-primary);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      .export-section {
        display: flex;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-lg);
        flex-wrap: wrap;
      }

      .empty-state {
        text-align: center;
        padding: var(--spacing-2xl);
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: var(--font-size-3xl);
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      @media (max-width: 640px) {
        .container {
          padding: var(--spacing-md);
        }

        header {
          flex-direction: column;
          align-items: flex-start;
        }

        .common-conversions {
          grid-template-columns: 1fr;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      @media (prefers-contrast: high) {
        .container {
          border: 3px solid var(--text-primary);
        }

        .converter-section,
        .result,
        .history-item,
        .common-btn {
          border-width: 3px;
        }
      }

      @media print {
        body {
          background: white;
        }

        .container {
          box-shadow: none;
          padding: 0;
        }

        .theme-selector,
        .tabs,
        .export-section,
        .btn {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>
          <span aria-hidden="true">📏</span>
          Unit Converter
        </h1>
        <div class="theme-selector" role="group" aria-label="Theme selection">
          <button
            class="theme-btn active"
            data-theme="pink"
            aria-label="Pink theme"
            aria-pressed="true"
          ></button>
          <button
            class="theme-btn"
            data-theme="blue"
            aria-label="Blue theme"
            aria-pressed="false"
          ></button>
          <button
            class="theme-btn"
            data-theme="green"
            aria-label="Green theme"
            aria-pressed="false"
          ></button>
          <button
            class="theme-btn"
            data-theme="purple"
            aria-label="Purple theme"
            aria-pressed="false"
          ></button>
          <button
            class="theme-btn"
            data-theme="orange"
            aria-label="Orange theme"
            aria-pressed="false"
          ></button>
        </div>
      </header>

      <div class="form-group">
        <label for="category">Category</label>
        <select id="category" aria-label="Select conversion category">
          <option value="length">Length</option>
          <option value="weight">Weight / Mass</option>
          <option value="temperature">Temperature</option>
          <option value="volume">Volume</option>
          <option value="area">Area</option>
          <option value="speed">Speed</option>
          <option value="time">Time</option>
          <option value="pressure">Pressure</option>
          <option value="energy">Energy</option>
          <option value="data">Data Storage</option>
        </select>
      </div>

      <div class="converter-section">
        <div class="form-group">
          <label for="fromValue">From</label>
          <input
            type="number"
            id="fromValue"
            value="1"
            aria-label="Value to convert from"
            step="any"
          />
          <select
            id="fromUnit"
            aria-label="Unit to convert from"
            style="margin-top: var(--spacing-sm)"
          ></select>
        </div>

        <button class="swap-btn" id="swapBtn" aria-label="Swap units">⇅</button>

        <div class="form-group">
          <label for="toUnit">To</label>
          <select id="toUnit" aria-label="Unit to convert to"></select>
        </div>
      </div>

      <div class="result" role="status" aria-live="polite">
        <div class="result-value" id="resultValue">0</div>
        <div class="result-label" id="resultLabel">Result</div>
      </div>

      <div class="tabs" role="tablist">
        <button
          class="tab active"
          data-tab="common"
          role="tab"
          aria-selected="true"
          aria-controls="common-panel"
        >
          Common
        </button>
        <button
          class="tab"
          data-tab="history"
          role="tab"
          aria-selected="false"
          aria-controls="history-panel"
        >
          History
        </button>
        <button
          class="tab"
          data-tab="export"
          role="tab"
          aria-selected="false"
          aria-controls="export-panel"
        >
          Export
        </button>
      </div>

      <main>
        <div
          id="common-panel"
          class="tab-content active"
          role="tabpanel"
          aria-labelledby="common-tab"
        >
          <div id="commonConversions" class="common-conversions"></div>
        </div>

        <div
          id="history-panel"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="history-tab"
        >
          <div id="historyList" class="history-list">
            <div class="empty-state">
              <div class="empty-state-icon">📜</div>
              <p>No conversion history yet</p>
              <p
                style="
                  font-size: var(--font-size-sm);
                  margin-top: var(--spacing-sm);
                "
              >
                Your conversions will appear here
              </p>
            </div>
          </div>
        </div>

        <div
          id="export-panel"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="export-tab"
        >
          <div class="export-section">
            <button
              class="btn"
              id="exportCsvBtn"
              aria-label="Export history as CSV"
            >
              <span aria-hidden="true">📊</span> Export CSV
            </button>
            <button
              class="btn"
              id="exportJsonBtn"
              aria-label="Export history as JSON"
            >
              <span aria-hidden="true">📋</span> Export JSON
            </button>
            <button
              class="btn btn-secondary"
              id="clearHistoryBtn"
              aria-label="Clear conversion history"
            >
              <span aria-hidden="true">🗑️</span> Clear History
            </button>
          </div>
        </div>
      </main>
    </div>
    <script>
      const units = {
        length: {
          meter: { factor: 1, label: "Meter (m)" },
          kilometer: { factor: 0.001, label: "Kilometer (km)" },
          centimeter: { factor: 100, label: "Centimeter (cm)" },
          millimeter: { factor: 1000, label: "Millimeter (mm)" },
          mile: { factor: 0.000621371, label: "Mile (mi)" },
          yard: { factor: 1.09361, label: "Yard (yd)" },
          foot: { factor: 3.28084, label: "Foot (ft)" },
          inch: { factor: 39.3701, label: "Inch (in)" },
        },
        weight: {
          kilogram: { factor: 1, label: "Kilogram (kg)" },
          gram: { factor: 1000, label: "Gram (g)" },
          milligram: { factor: 1000000, label: "Milligram (mg)" },
          ton: { factor: 0.001, label: "Metric Ton (t)" },
          pound: { factor: 2.20462, label: "Pound (lb)" },
          ounce: { factor: 35.274, label: "Ounce (oz)" },
        },
        volume: {
          liter: { factor: 1, label: "Liter (L)" },
          milliliter: { factor: 1000, label: "Milliliter (mL)" },
          cubicMeter: { factor: 0.001, label: "Cubic Meter (m³)" },
          gallon: { factor: 0.264172, label: "Gallon (gal)" },
          quart: { factor: 1.05669, label: "Quart (qt)" },
          pint: { factor: 2.11338, label: "Pint (pt)" },
          cup: { factor: 4.22675, label: "Cup" },
          fluidOunce: { factor: 33.814, label: "Fluid Ounce (fl oz)" },
        },
        area: {
          squareMeter: { factor: 1, label: "Square Meter (m²)" },
          squareKilometer: {
            factor: 0.000001,
            label: "Square Kilometer (km²)",
          },
          squareCentimeter: { factor: 10000, label: "Square Centimeter (cm²)" },
          hectare: { factor: 0.0001, label: "Hectare (ha)" },
          acre: { factor: 0.000247105, label: "Acre" },
          squareMile: { factor: 3.861e-7, label: "Square Mile (mi²)" },
          squareYard: { factor: 1.19599, label: "Square Yard (yd²)" },
          squareFoot: { factor: 10.7639, label: "Square Foot (ft²)" },
        },
        speed: {
          meterPerSecond: { factor: 1, label: "Meter/Second (m/s)" },
          kilometerPerHour: { factor: 3.6, label: "Kilometer/Hour (km/h)" },
          milePerHour: { factor: 2.23694, label: "Mile/Hour (mph)" },
          knot: { factor: 1.94384, label: "Knot (kn)" },
          footPerSecond: { factor: 3.28084, label: "Foot/Second (ft/s)" },
        },
        time: {
          second: { factor: 1, label: "Second (s)" },
          minute: { factor: 1 / 60, label: "Minute (min)" },
          hour: { factor: 1 / 3600, label: "Hour (h)" },
          day: { factor: 1 / 86400, label: "Day" },
          week: { factor: 1 / 604800, label: "Week" },
          month: { factor: 1 / 2628000, label: "Month (avg)" },
          year: { factor: 1 / 31536000, label: "Year" },
        },
        pressure: {
          pascal: { factor: 1, label: "Pascal (Pa)" },
          kilopascal: { factor: 0.001, label: "Kilopascal (kPa)" },
          bar: { factor: 0.00001, label: "Bar" },
          psi: { factor: 0.000145038, label: "PSI" },
          atmosphere: { factor: 9.8692e-6, label: "Atmosphere (atm)" },
          torr: { factor: 0.00750062, label: "Torr" },
        },
        energy: {
          joule: { factor: 1, label: "Joule (J)" },
          kilojoule: { factor: 0.001, label: "Kilojoule (kJ)" },
          calorie: { factor: 0.239006, label: "Calorie (cal)" },
          kilocalorie: { factor: 0.000239006, label: "Kilocalorie (kcal)" },
          wattHour: { factor: 0.000277778, label: "Watt-hour (Wh)" },
          kilowattHour: { factor: 2.7778e-7, label: "Kilowatt-hour (kWh)" },
        },
        data: {
          byte: { factor: 1, label: "Byte (B)" },
          kilobyte: { factor: 0.001, label: "Kilobyte (KB)" },
          megabyte: { factor: 0.000001, label: "Megabyte (MB)" },
          gigabyte: { factor: 1e-9, label: "Gigabyte (GB)" },
          terabyte: { factor: 1e-12, label: "Terabyte (TB)" },
          bit: { factor: 8, label: "Bit (b)" },
          kilobit: { factor: 0.008, label: "Kilobit (Kb)" },
          megabit: { factor: 0.000008, label: "Megabit (Mb)" },
        },
        temperature: {
          celsius: {
            label: "Celsius (°C)",
            to: (v, unit) => {
              if (unit === "fahrenheit") return (v * 9) / 5 + 32;
              if (unit === "kelvin") return v + 273.15;
              return v;
            },
          },
          fahrenheit: {
            label: "Fahrenheit (°F)",
            to: (v, unit) => {
              if (unit === "celsius") return ((v - 32) * 5) / 9;
              if (unit === "kelvin") return ((v - 32) * 5) / 9 + 273.15;
              return v;
            },
          },
          kelvin: {
            label: "Kelvin (K)",
            to: (v, unit) => {
              if (unit === "celsius") return v - 273.15;
              if (unit === "fahrenheit") return ((v - 273.15) * 9) / 5 + 32;
              return v;
            },
          },
        },
      };

      const commonConversions = {
        length: [
          { from: "meter", to: "foot", label: "Meters to Feet" },
          { from: "kilometer", to: "mile", label: "Kilometers to Miles" },
          { from: "inch", to: "centimeter", label: "Inches to Centimeters" },
          { from: "mile", to: "kilometer", label: "Miles to Kilometers" },
        ],
        weight: [
          { from: "kilogram", to: "pound", label: "Kilograms to Pounds" },
          { from: "pound", to: "kilogram", label: "Pounds to Kilograms" },
          { from: "gram", to: "ounce", label: "Grams to Ounces" },
          { from: "ton", to: "pound", label: "Tons to Pounds" },
        ],
        temperature: [
          { from: "celsius", to: "fahrenheit", label: "Celsius to Fahrenheit" },
          { from: "fahrenheit", to: "celsius", label: "Fahrenheit to Celsius" },
          { from: "celsius", to: "kelvin", label: "Celsius to Kelvin" },
          { from: "kelvin", to: "celsius", label: "Kelvin to Celsius" },
        ],
        volume: [
          { from: "liter", to: "gallon", label: "Liters to Gallons" },
          { from: "gallon", to: "liter", label: "Gallons to Liters" },
          { from: "milliliter", to: "fluidOunce", label: "mL to Fluid Ounces" },
          { from: "cup", to: "milliliter", label: "Cups to Milliliters" },
        ],
        area: [
          { from: "squareMeter", to: "squareFoot", label: "m² to ft²" },
          { from: "hectare", to: "acre", label: "Hectares to Acres" },
          { from: "acre", to: "squareMeter", label: "Acres to m²" },
          { from: "squareKilometer", to: "squareMile", label: "km² to mi²" },
        ],
        speed: [
          { from: "kilometerPerHour", to: "milePerHour", label: "km/h to mph" },
          { from: "milePerHour", to: "kilometerPerHour", label: "mph to km/h" },
          {
            from: "meterPerSecond",
            to: "kilometerPerHour",
            label: "m/s to km/h",
          },
          { from: "knot", to: "kilometerPerHour", label: "Knots to km/h" },
        ],
        time: [
          { from: "hour", to: "minute", label: "Hours to Minutes" },
          { from: "day", to: "hour", label: "Days to Hours" },
          { from: "week", to: "day", label: "Weeks to Days" },
          { from: "year", to: "day", label: "Years to Days" },
        ],
        pressure: [
          { from: "pascal", to: "psi", label: "Pascal to PSI" },
          { from: "bar", to: "psi", label: "Bar to PSI" },
          { from: "atmosphere", to: "pascal", label: "atm to Pascal" },
          { from: "psi", to: "bar", label: "PSI to Bar" },
        ],
        energy: [
          { from: "joule", to: "calorie", label: "Joules to Calories" },
          { from: "kilocalorie", to: "kilojoule", label: "kcal to kJ" },
          { from: "kilowattHour", to: "joule", label: "kWh to Joules" },
          { from: "wattHour", to: "joule", label: "Wh to Joules" },
        ],
        data: [
          { from: "megabyte", to: "gigabyte", label: "MB to GB" },
          { from: "gigabyte", to: "terabyte", label: "GB to TB" },
          { from: "byte", to: "kilobyte", label: "Bytes to KB" },
          { from: "megabit", to: "megabyte", label: "Mb to MB" },
        ],
      };

      let history = [];
      let currentTheme = "pink";

      function init() {
        loadSettings();
        setupEventListeners();
        updateUnits();
      }

      function setupEventListeners() {
        document
          .getElementById("category")
          .addEventListener("change", handleCategoryChange);
        document.getElementById("fromValue").addEventListener("input", convert);
        document.getElementById("fromUnit").addEventListener("change", convert);
        document.getElementById("toUnit").addEventListener("change", convert);
        document.getElementById("swapBtn").addEventListener("click", swapUnits);

        document
          .getElementById("exportCsvBtn")
          .addEventListener("click", exportCsv);
        document
          .getElementById("exportJsonBtn")
          .addEventListener("click", exportJson);
        document
          .getElementById("clearHistoryBtn")
          .addEventListener("click", clearHistory);

        document.querySelectorAll(".theme-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document.querySelectorAll(".theme-btn").forEach((b) => {
              b.classList.remove("active");
              b.setAttribute("aria-pressed", "false");
            });
            this.classList.add("active");
            this.setAttribute("aria-pressed", "true");
            currentTheme = this.dataset.theme;
            document.body.dataset.theme = currentTheme;
            saveSettings();
          });
        });

        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabName = this.dataset.tab;
            document.querySelectorAll(".tab").forEach((t) => {
              t.classList.remove("active");
              t.setAttribute("aria-selected", "false");
            });
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));
            this.classList.add("active");
            this.setAttribute("aria-selected", "true");
            document.getElementById(`${tabName}-panel`).classList.add("active");
          });
        });
      }

      function handleCategoryChange() {
        updateUnits();
        updateCommonConversions();
      }

      function updateUnits() {
        const category = document.getElementById("category").value;
        const fromUnit = document.getElementById("fromUnit");
        const toUnit = document.getElementById("toUnit");

        fromUnit.innerHTML = "";
        toUnit.innerHTML = "";

        const categoryUnits = units[category];
        Object.keys(categoryUnits).forEach((unitKey) => {
          const unit = categoryUnits[unitKey];
          fromUnit.add(new Option(unit.label, unitKey));
          toUnit.add(new Option(unit.label, unitKey));
        });

        toUnit.selectedIndex = Math.min(
          1,
          Object.keys(categoryUnits).length - 1
        );
        convert();
        updateCommonConversions();
      }

      function swapUnits() {
        const fromUnit = document.getElementById("fromUnit");
        const toUnit = document.getElementById("toUnit");
        const fromValue = document.getElementById("fromValue");
        const resultValue = document.getElementById("resultValue");

        const tempUnit = fromUnit.value;
        fromUnit.value = toUnit.value;
        toUnit.value = tempUnit;

        fromValue.value = resultValue.textContent;
        convert();
        announceToScreenReader("Units swapped");
      }

      function convert() {
        const category = document.getElementById("category").value;
        const value =
          parseFloat(document.getElementById("fromValue").value) || 0;
        const fromUnitKey = document.getElementById("fromUnit").value;
        const toUnitKey = document.getElementById("toUnit").value;

        let result;
        if (category === "temperature") {
          result = units[category][fromUnitKey].to(value, toUnitKey);
        } else {
          const baseValue = value / units[category][fromUnitKey].factor;
          result = baseValue * units[category][toUnitKey].factor;
        }

        const formatted = formatResult(result);
        document.getElementById("resultValue").textContent = formatted;
        document.getElementById("resultLabel").textContent =
          units[category][toUnitKey].label;

        addToHistory(category, value, fromUnitKey, result, toUnitKey);
      }

      function formatResult(value) {
        if (Math.abs(value) < 0.0001 || Math.abs(value) > 1000000) {
          return value.toExponential(4);
        }
        return value.toFixed(6).replace(/\.?0+$/, "");
      }

      function addToHistory(category, fromValue, fromUnit, toValue, toUnit) {
        const entry = {
          date: new Date().toISOString(),
          category,
          fromValue,
          fromUnit: units[category][fromUnit].label,
          toValue: formatResult(toValue),
          toUnit: units[category][toUnit].label,
        };

        history.unshift(entry);
        if (history.length > 100) {
          history = history.slice(0, 100);
        }

        try {
          localStorage.setItem("unitConverterHistory", JSON.stringify(history));
          updateHistoryDisplay();
        } catch (e) {
          console.error("Failed to save history:", e);
        }
      }

      function updateHistoryDisplay() {
        const historyList = document.getElementById("historyList");

        if (history.length === 0) {
          historyList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">📜</div>
              <p>No conversion history yet</p>
              <p style="font-size: var(--font-size-sm); margin-top: var(--spacing-sm);">
                Your conversions will appear here
              </p>
            </div>`;
          return;
        }

        historyList.innerHTML = history
          .slice(0, 50)
          .map(
            (entry) => `
          <div class="history-item">
            <div class="history-date">${new Date(
              entry.date
            ).toLocaleString()} • ${entry.category}</div>
            <div class="history-conversion">
              ${entry.fromValue} ${entry.fromUnit} = ${entry.toValue} ${
              entry.toUnit
            }
            </div>
          </div>
        `
          )
          .join("");
      }

      function updateCommonConversions() {
        const category = document.getElementById("category").value;
        const conversions = commonConversions[category] || [];
        const container = document.getElementById("commonConversions");

        if (conversions.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <p>No common conversions for this category</p>
            </div>`;
          return;
        }

        container.innerHTML = conversions
          .map(
            (conv) => `
          <button class="common-btn" onclick="applyCommonConversion('${
            conv.from
          }', '${conv.to}')">
            <span class="common-btn-label">${conv.label}</span>
            <span class="common-btn-desc">${
              units[category][conv.from].label
            } → ${units[category][conv.to].label}</span>
          </button>
        `
          )
          .join("");
      }

      function applyCommonConversion(fromUnit, toUnit) {
        document.getElementById("fromUnit").value = fromUnit;
        document.getElementById("toUnit").value = toUnit;
        convert();
        announceToScreenReader(
          `Changed to ${fromUnit} to ${toUnit} conversion`
        );
      }

      function exportCsv() {
        if (history.length === 0) {
          alert("No history to export!");
          return;
        }

        const headers = [
          "Date",
          "Category",
          "From Value",
          "From Unit",
          "To Value",
          "To Unit",
        ];
        const rows = history.map((h) => [
          new Date(h.date).toLocaleString(),
          h.category,
          h.fromValue,
          h.fromUnit,
          h.toValue,
          h.toUnit,
        ]);

        const csv = [headers, ...rows]
          .map((row) => row.map((cell) => `"${cell}"`).join(","))
          .join("\n");
        const blob = new Blob([csv], { type: "text/csv" });
        downloadFile(blob, `unit-converter-history-${Date.now()}.csv`);
        announceToScreenReader("History exported as CSV");
      }

      function exportJson() {
        if (history.length === 0) {
          alert("No history to export!");
          return;
        }

        const data = {
          history: history,
          exportDate: new Date().toISOString(),
          totalConversions: history.length,
        };

        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: "application/json" });
        downloadFile(blob, `unit-converter-history-${Date.now()}.json`);
        announceToScreenReader("History exported as JSON");
      }

      function downloadFile(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      }

      function clearHistory() {
        if (confirm("Clear all conversion history?")) {
          history = [];
          localStorage.removeItem("unitConverterHistory");
          updateHistoryDisplay();
          announceToScreenReader("History cleared");
        }
      }

      function saveSettings() {
        const settings = {
          theme: currentTheme,
          category: document.getElementById("category").value,
        };
        try {
          localStorage.setItem(
            "unitConverterSettings",
            JSON.stringify(settings)
          );
        } catch (e) {
          console.error("Failed to save settings:", e);
        }
      }

      function loadSettings() {
        try {
          const savedSettings = localStorage.getItem("unitConverterSettings");
          if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            currentTheme = settings.theme || "pink";
            document.body.dataset.theme = currentTheme;

            if (settings.category) {
              document.getElementById("category").value = settings.category;
            }

            document.querySelectorAll(".theme-btn").forEach((btn) => {
              if (btn.dataset.theme === currentTheme) {
                btn.classList.add("active");
                btn.setAttribute("aria-pressed", "true");
              } else {
                btn.classList.remove("active");
                btn.setAttribute("aria-pressed", "false");
              }
            });
          }

          const savedHistory = localStorage.getItem("unitConverterHistory");
          if (savedHistory) {
            history = JSON.parse(savedHistory);
            updateHistoryDisplay();
          }
        } catch (e) {
          console.error("Failed to load settings:", e);
        }
      }

      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("role", "status");
        announcement.setAttribute("aria-live", "polite");
        announcement.className = "sr-only";
        announcement.textContent = message;
        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      }

      init();
    </script>
  </body>
</html>
