<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Reaction Time Test - Measure Your Reflexes & Speed | iowidgets
    </title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-S15806B1HW"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-S15806B1HW");
    </script>
    <meta
      name="description"
      content="Test your reaction time with our interactive reflex speed test. Multiple game modes, difficulty levels, leaderboards, statistics tracking, and performance analytics. Improve your reflexes today!"
    />
    <meta
      name="keywords"
      content="reaction time test, reflex test, speed test, reaction speed, reflex game, reaction time game, measure reflexes, cognitive test, brain training, response time"
    />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://iowidgets.com/widgets/reaction-time.html"
    />
    <meta
      property="og:title"
      content="Reaction Time Test - Measure Your Reflexes & Speed"
    />
    <meta
      property="og:description"
      content="Test your reaction time with multiple game modes, difficulty levels, and performance tracking. See how fast your reflexes really are!"
    />
    <meta
      property="og:image"
      content="https://iowidgets.com/assets/reaction-time-preview.png"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta
      property="twitter:url"
      content="https://iowidgets.com/widgets/reaction-time.html"
    />
    <meta
      property="twitter:title"
      content="Reaction Time Test - Measure Your Reflexes & Speed"
    />
    <meta
      property="twitter:description"
      content="Test your reaction time with multiple game modes, difficulty levels, and performance tracking. See how fast your reflexes really are!"
    />
    <meta
      property="twitter:image"
      content="https://iowidgets.com/assets/reaction-time-preview.png"
    />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="https://iowidgets.com/widgets/reaction-time.html"
    />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Reaction Time Test",
        "description": "Interactive reaction time test with multiple game modes, difficulty levels, and performance tracking",
        "url": "https://iowidgets.com/widgets/reaction-time.html",
        "applicationCategory": "GameApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "Multiple game modes (Classic, Precision, Endurance)",
          "Three difficulty levels",
          "Real-time leaderboard",
          "Statistics tracking and analytics",
          "Sound effects and visual feedback",
          "Performance ratings and achievements",
          "Export and share results"
        ]
      }
    </script>
    <style>
      :root {
        --color-primary: #667eea;
        --color-primary-dark: #5a67d8;
        --color-secondary: #764ba2;
        --color-accent: #f093fb;
        --color-waiting: #ef4444;
        --color-ready: #f59e0b;
        --color-go: #10b981;
        --color-excellent: #10b981;
        --color-great: #3b82f6;
        --color-good: #8b5cf6;
        --color-average: #f59e0b;
        --color-slow: #ef4444;
        --color-bg-primary: #ffffff;
        --color-bg-secondary: #f9fafb;
        --color-text-primary: #1f2937;
        --color-text-secondary: #6b7280;
        --color-border: #e5e7eb;
        --spacing-xs: 0.5rem;
        --spacing-sm: 0.75rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        --font-size-xs: 0.75rem;
        --font-size-sm: 0.875rem;
        --font-size-base: 1rem;
        --font-size-lg: 1.125rem;
        --font-size-xl: 1.25rem;
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-full: 9999px;
        --transition-fast: 0.15s ease;
        --transition-base: 0.3s ease;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: var(--font-family);
        background: linear-gradient(
          135deg,
          var(--color-primary) 0%,
          var(--color-secondary) 100%
        );
        min-height: 100vh;
        padding: var(--spacing-md);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        width: 100%;
        max-width: 800px;
        padding: var(--spacing-lg);
        backdrop-filter: blur(10px);
      }
      h1 {
        font-size: clamp(1.5rem, 5vw, 2rem);
        color: var(--color-text-primary);
        text-align: center;
        margin-bottom: var(--spacing-xs);
        font-weight: 700;
      }
      .subtitle {
        text-align: center;
        color: var(--color-text-secondary);
        font-size: var(--font-size-sm);
        margin-bottom: var(--spacing-xl);
      }
      .controls {
        display: grid;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
        grid-template-columns: 1fr;
      }
      .control-group {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
      }
      label {
        font-size: var(--font-size-sm);
        font-weight: 600;
        color: var(--color-text-primary);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }
      select,
      button {
        padding: 0.75rem var(--spacing-md);
        border-radius: var(--radius-md);
        font-size: var(--font-size-base);
        font-family: var(--font-family);
        transition: all var(--transition-base);
        border: 2px solid var(--color-border);
        min-height: 44px;
        cursor: pointer;
      }
      select {
        background: var(--color-bg-primary);
        color: var(--color-text-primary);
        appearance: none;
        -webkit-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        padding-right: 2.5rem;
      }
      select:hover {
        border-color: var(--color-primary);
      }
      select:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }
      .toggle-group {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex-wrap: wrap;
      }
      .toggle {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
      }
      .toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background-color: #ccc;
        transition: var(--transition-base);
        border-radius: var(--radius-full);
      }
      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: var(--transition-base);
        border-radius: 50%;
      }
      .toggle input:checked + .toggle-slider {
        background-color: var(--color-primary);
      }
      .toggle input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }
      .game-area {
        width: 100%;
        height: 350px;
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin-bottom: var(--spacing-xl);
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
        border: 3px solid transparent;
      }
      .game-area.waiting {
        background: linear-gradient(
          135deg,
          var(--color-waiting) 0%,
          #dc2626 100%
        );
        border-color: var(--color-waiting);
      }
      .game-area.ready {
        background: linear-gradient(
          135deg,
          var(--color-ready) 0%,
          #d97706 100%
        );
        border-color: var(--color-ready);
      }
      .game-area.go {
        background: linear-gradient(135deg, var(--color-go) 0%, #059669 100%);
        border-color: var(--color-go);
        animation: pulse 1s ease-in-out infinite;
      }
      .game-area.idle {
        background: linear-gradient(
          135deg,
          var(--color-primary) 0%,
          var(--color-secondary) 100%
        );
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }
      .game-message {
        color: white;
        font-size: clamp(1.25rem, 4vw, 1.75rem);
        font-weight: 700;
        text-align: center;
        padding: var(--spacing-md);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .game-instruction {
        color: rgba(255, 255, 255, 0.9);
        font-size: var(--font-size-sm);
        text-align: center;
        margin-top: var(--spacing-sm);
      }
      .stats-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
      }
      .stat-card {
        background: var(--color-bg-secondary);
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 2px solid var(--color-border);
        transition: all var(--transition-base);
      }
      .stat-card:hover {
        border-color: var(--color-primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }
      .stat-label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        margin-bottom: var(--spacing-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .stat-value {
        font-size: clamp(1.75rem, 4vw, 2.5rem);
        font-weight: 700;
        color: var(--color-text-primary);
      }
      .stat-value.excellent {
        color: var(--color-excellent);
      }
      .stat-value.great {
        color: var(--color-great);
      }
      .stat-value.good {
        color: var(--color-good);
      }
      .stat-value.average {
        color: var(--color-average);
      }
      .stat-value.slow {
        color: var(--color-slow);
      }
      .stat-subtitle {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
        margin-top: var(--spacing-xs);
      }
      .attempts {
        margin-bottom: var(--spacing-xl);
      }
      .attempts h3 {
        font-size: var(--font-size-lg);
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-md);
        font-weight: 600;
      }
      .attempts-list {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
      }
      .attempt-badge {
        padding: var(--spacing-xs) var(--spacing-md);
        background: var(--color-bg-secondary);
        border-radius: var(--radius-full);
        font-size: var(--font-size-sm);
        font-weight: 600;
        border: 2px solid var(--color-border);
        transition: all var(--transition-base);
        min-height: 36px;
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }
      .attempt-badge:hover {
        transform: translateY(-2px);
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }
      .attempt-badge.excellent {
        background: rgba(16, 185, 129, 0.1);
        border-color: var(--color-excellent);
        color: var(--color-excellent);
      }
      .attempt-badge.great {
        background: rgba(59, 130, 246, 0.1);
        border-color: var(--color-great);
        color: var(--color-great);
      }
      .attempt-badge.good {
        background: rgba(139, 92, 246, 0.1);
        border-color: var(--color-good);
        color: var(--color-good);
      }
      .attempt-badge.average {
        background: rgba(245, 158, 11, 0.1);
        border-color: var(--color-average);
        color: var(--color-average);
      }
      .attempt-badge.slow {
        background: rgba(239, 68, 68, 0.1);
        border-color: var(--color-slow);
        color: var(--color-slow);
      }
      .leaderboard {
        margin-bottom: var(--spacing-xl);
      }
      .leaderboard h3 {
        font-size: var(--font-size-lg);
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-md);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }
      .leaderboard-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--color-bg-secondary);
        border-radius: var(--radius-lg);
        overflow: hidden;
      }
      .leaderboard-table th,
      .leaderboard-table td {
        padding: var(--spacing-md);
        text-align: left;
        border-bottom: 1px solid var(--color-border);
      }
      .leaderboard-table th {
        background: var(--color-primary);
        color: white;
        font-weight: 600;
        font-size: var(--font-size-sm);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .leaderboard-table tr:last-child td {
        border-bottom: none;
      }
      .leaderboard-table tr:hover {
        background: rgba(102, 126, 234, 0.05);
      }
      .rank-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        font-weight: 700;
        font-size: var(--font-size-sm);
      }
      .rank-badge.rank-1 {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        color: #854d0e;
      }
      .rank-badge.rank-2 {
        background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
        color: #3f3f46;
      }
      .rank-badge.rank-3 {
        background: linear-gradient(135deg, #cd7f32 0%, #e69b5a 100%);
        color: white;
      }
      .rank-badge.rank-other {
        background: var(--color-bg-primary);
        color: var(--color-text-secondary);
      }
      .actions {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }
      button.btn {
        padding: 0.875rem var(--spacing-lg);
        border: none;
        border-radius: var(--radius-md);
        font-size: var(--font-size-base);
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-base);
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
      }
      button.btn-primary {
        background: linear-gradient(
          135deg,
          var(--color-primary) 0%,
          var(--color-primary-dark) 100%
        );
        color: white;
      }
      button.btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }
      button.btn-primary:active {
        transform: translateY(0);
      }
      button.btn-secondary {
        background: var(--color-bg-secondary);
        color: var(--color-text-primary);
        border: 2px solid var(--color-border);
      }
      button.btn-secondary:hover {
        border-color: var(--color-primary);
        background: var(--color-bg-primary);
      }
      button.btn-danger {
        background: linear-gradient(
          135deg,
          var(--color-waiting) 0%,
          #dc2626 100%
        );
        color: white;
      }
      button.btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }
      .chart-container {
        background: var(--color-bg-secondary);
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        margin-bottom: var(--spacing-xl);
        border: 2px solid var(--color-border);
      }
      .chart-container h3 {
        font-size: var(--font-size-lg);
        color: var(--color-text-primary);
        margin-bottom: var(--spacing-md);
        font-weight: 600;
      }
      .chart {
        display: flex;
        align-items: flex-end;
        gap: 4px;
        height: 150px;
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        background: var(--color-bg-primary);
      }
      .chart-bar {
        flex: 1;
        background: linear-gradient(
          to top,
          var(--color-primary),
          var(--color-accent)
        );
        border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        min-height: 4px;
        transition: all var(--transition-base);
        position: relative;
        cursor: pointer;
      }
      .chart-bar:hover {
        opacity: 0.8;
        transform: scaleY(1.05);
      }
      .chart-bar-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: var(--color-text-primary);
        color: white;
        padding: var(--spacing-xs);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-xs);
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--transition-fast);
        margin-bottom: 4px;
      }
      .chart-bar:hover .chart-bar-tooltip {
        opacity: 1;
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
      @media (min-width: 640px) {
        .container {
          padding: var(--spacing-xl);
        }
        .controls {
          grid-template-columns: repeat(2, 1fr);
        }
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .actions {
          grid-template-columns: repeat(2, 1fr);
        }
        .game-area {
          height: 400px;
        }
      }
      @media (min-width: 1024px) {
        .stats-grid {
          grid-template-columns: repeat(4, 1fr);
        }
        .actions {
          grid-template-columns: repeat(4, 1fr);
        }
      }
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
      @media (prefers-contrast: high) {
        .container {
          border: 3px solid var(--color-text-primary);
        }
        button,
        select {
          border-width: 3px;
        }
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --color-bg-primary: #1f2937;
          --color-bg-secondary: #111827;
          --color-text-primary: #f9fafb;
          --color-text-secondary: #d1d5db;
          --color-border: #374151;
        }
        .container {
          background: rgba(31, 41, 55, 0.95);
        }
      }
      *:focus-visible {
        outline: 3px solid var(--color-primary);
        outline-offset: 2px;
      }
      @media print {
        body {
          background: white;
        }
        .container {
          box-shadow: none;
          max-width: 100%;
        }
        .actions,
        .controls {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header role="banner">
        <h1>⚡ Reaction Time Test</h1>
        <p class="subtitle">
          Test your reflexes and see how fast you can react!
        </p>
      </header>

      <main role="main">
        <section class="controls" aria-label="Game Settings">
          <div class="control-group">
            <label for="gameMode">
              <span aria-hidden="true">🎮</span>
              Game Mode
            </label>
            <select id="gameMode" aria-describedby="gameModeDesc">
              <option value="classic">Classic - Single Click</option>
              <option value="precision">Precision - 5 Attempts</option>
              <option value="endurance">Endurance - 10 Attempts</option>
            </select>
            <span class="sr-only" id="gameModeDesc">Select the game mode</span>
          </div>

          <div class="control-group">
            <label for="difficulty">
              <span aria-hidden="true">⚙️</span>
              Difficulty
            </label>
            <select id="difficulty" aria-describedby="difficultyDesc">
              <option value="easy">Easy (3-6s delay)</option>
              <option value="medium" selected>Medium (2-5s delay)</option>
              <option value="hard">Hard (1-3s delay)</option>
            </select>
            <span class="sr-only" id="difficultyDesc">Select difficulty</span>
          </div>

          <div class="control-group toggle-group">
            <label for="soundToggle">
              <span aria-hidden="true">🔊</span>
              Sound Effects
            </label>
            <label class="toggle">
              <input
                type="checkbox"
                id="soundToggle"
                checked
                aria-label="Toggle sound"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="control-group toggle-group">
            <label for="vibrationToggle">
              <span aria-hidden="true">📳</span>
              Vibration
            </label>
            <label class="toggle">
              <input
                type="checkbox"
                id="vibrationToggle"
                checked
                aria-label="Toggle vibration"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </section>

        <div
          class="game-area idle"
          id="gameArea"
          role="button"
          tabindex="0"
          aria-label="Game area"
          aria-live="polite"
        >
          <div>
            <div class="game-message" id="gameMessage">Click to Start</div>
            <div class="game-instruction" id="gameInstruction">
              Press Space or Click
            </div>
          </div>
        </div>

        <section class="stats-grid" aria-label="Statistics">
          <div class="stat-card">
            <div class="stat-label">Best Time</div>
            <div class="stat-value" id="bestTime">-</div>
            <div class="stat-subtitle" id="bestRating">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Last Time</div>
            <div class="stat-value" id="lastTime">-</div>
            <div class="stat-subtitle" id="lastRating">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Average</div>
            <div class="stat-value" id="avgTime">-</div>
            <div class="stat-subtitle" id="avgRating">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Attempts</div>
            <div class="stat-value" id="totalAttempts">0</div>
            <div class="stat-subtitle">Total clicks</div>
          </div>
        </section>

        <section
          class="chart-container"
          id="chartSection"
          style="display: none"
        >
          <h3>📊 Performance Trend</h3>
          <div
            class="chart"
            id="chart"
            role="img"
            aria-label="Performance chart"
          ></div>
        </section>

        <section class="attempts" id="attemptsSection" style="display: none">
          <h3>🎯 Recent Attempts</h3>
          <div class="attempts-list" id="attemptsList" role="list"></div>
        </section>

        <section
          class="leaderboard"
          id="leaderboardSection"
          style="display: none"
        >
          <h3><span aria-hidden="true">🏆</span>Top 10 Best Times</h3>
          <table class="leaderboard-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Time</th>
                <th>Mode</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="leaderboardBody"></tbody>
          </table>
        </section>

        <section class="actions" aria-label="Actions">
          <button class="btn btn-primary" id="resetBtn">
            <span aria-hidden="true">🔄</span>
            Reset Stats
          </button>
          <button class="btn btn-secondary" id="exportBtn">
            <span aria-hidden="true">📥</span>
            Export Results
          </button>
          <button class="btn btn-secondary" id="shareBtn">
            <span aria-hidden="true">📤</span>
            Share Results
          </button>
          <button class="btn btn-danger" id="clearLeaderboardBtn">
            <span aria-hidden="true">🗑️</span>
            Clear Leaderboard
          </button>
        </section>
      </main>
    </div>

    <script>
      let state = "idle";
      let startTime = null;
      let timeoutId = null;
      let attempts = [];
      let currentMode = "classic";
      let currentDifficulty = "medium";
      let sessionAttempts = 0;
      let maxAttemptsForMode = 1;
      let leaderboard = [];
      let soundEnabled = true;
      let vibrationEnabled = true;

      const gameArea = document.getElementById("gameArea");
      const gameMessage = document.getElementById("gameMessage");
      const gameInstruction = document.getElementById("gameInstruction");
      const gameModeSelect = document.getElementById("gameMode");
      const difficultySelect = document.getElementById("difficulty");
      const soundToggle = document.getElementById("soundToggle");
      const vibrationToggle = document.getElementById("vibrationToggle");
      const bestTimeEl = document.getElementById("bestTime");
      const lastTimeEl = document.getElementById("lastTime");
      const avgTimeEl = document.getElementById("avgTime");
      const totalAttemptsEl = document.getElementById("totalAttempts");
      const bestRatingEl = document.getElementById("bestRating");
      const lastRatingEl = document.getElementById("lastRating");
      const avgRatingEl = document.getElementById("avgRating");
      const attemptsListEl = document.getElementById("attemptsList");
      const chartEl = document.getElementById("chart");
      const leaderboardBodyEl = document.getElementById("leaderboardBody");
      const attemptsSection = document.getElementById("attemptsSection");
      const chartSection = document.getElementById("chartSection");
      const leaderboardSection = document.getElementById("leaderboardSection");

      const AudioContext = window.AudioContext || window.webkitAudioContext;
      let audioContext = null;

      function init() {
        loadFromStorage();
        updateStats();
        updateLeaderboard();

        gameArea.addEventListener("click", handleGameClick);
        gameArea.addEventListener("keydown", handleKeyDown);
        gameModeSelect.addEventListener("change", handleModeChange);
        difficultySelect.addEventListener("change", handleDifficultyChange);
        soundToggle.addEventListener(
          "change",
          () => (soundEnabled = soundToggle.checked)
        );
        vibrationToggle.addEventListener(
          "change",
          () => (vibrationEnabled = vibrationToggle.checked)
        );
        document
          .getElementById("resetBtn")
          .addEventListener("click", resetStats);
        document
          .getElementById("exportBtn")
          .addEventListener("click", exportResults);
        document
          .getElementById("shareBtn")
          .addEventListener("click", shareResults);
        document
          .getElementById("clearLeaderboardBtn")
          .addEventListener("click", clearLeaderboard);
      }

      function handleGameClick() {
        if (state === "idle") {
          startGame();
        } else if (state === "go") {
          recordReaction();
        } else if (state === "waiting" || state === "ready") {
          earlyClick();
        }
      }

      function handleKeyDown(e) {
        if (e.key === " " || e.key === "Enter") {
          e.preventDefault();
          handleGameClick();
        } else if (e.key === "Escape") {
          resetGame();
        }
      }

      function startGame() {
        state = "waiting";
        gameArea.className = "game-area waiting";
        gameMessage.textContent = "Wait for green...";
        gameInstruction.textContent = "Don't click yet!";
        announceToScreenReader("Game started. Wait for green.");

        const delay = getRandomDelay();

        timeoutId = setTimeout(() => {
          if (state === "waiting") {
            state = "ready";
            gameArea.className = "game-area ready";
            gameMessage.textContent = "Get ready...";
            gameInstruction.textContent = "Almost there...";

            setTimeout(() => {
              if (state === "ready") {
                state = "go";
                startTime = Date.now();
                gameArea.className = "game-area go";
                gameMessage.textContent = "CLICK NOW!";
                gameInstruction.textContent = "Click as fast as you can!";
                announceToScreenReader("Go! Click now!");
                playSound("go");
                vibrate(50);
              }
            }, 1000);
          }
        }, delay);
      }

      function recordReaction() {
        const reactionTime = Date.now() - startTime;
        attempts.push(reactionTime);
        sessionAttempts++;

        playSound("success");
        vibrate(100);

        gameArea.className = "game-area idle";
        gameMessage.textContent = `${reactionTime}ms`;
        const rating = getRating(reactionTime);
        gameInstruction.textContent = rating.text;
        announceToScreenReader(
          `Reaction time: ${reactionTime}ms. ${rating.text}`
        );

        addToLeaderboard(reactionTime);
        updateStats();
        updateAttemptsList();
        updateChart();
        updateLeaderboard();
        saveToStorage();

        if (sessionAttempts >= maxAttemptsForMode) {
          setTimeout(() => {
            state = "idle";
            sessionAttempts = 0;
            gameMessage.textContent = "Session Complete!";
            gameInstruction.textContent = "Click to start again";
            announceToScreenReader("Session complete.");
          }, 2000);
        } else {
          setTimeout(() => {
            state = "idle";
            gameMessage.textContent = `${
              maxAttemptsForMode - sessionAttempts
            } more to go`;
            gameInstruction.textContent = "Click to continue";
            announceToScreenReader(
              `${maxAttemptsForMode - sessionAttempts} attempts remaining`
            );
          }, 2000);
        }
      }

      function earlyClick() {
        clearTimeout(timeoutId);
        state = "idle";
        gameArea.className = "game-area idle";
        gameMessage.textContent = "Too Early!";
        gameInstruction.textContent = "Wait for green next time";
        announceToScreenReader("Too early!");
        playSound("error");
        vibrate([100, 50, 100]);
      }

      function resetGame() {
        clearTimeout(timeoutId);
        state = "idle";
        sessionAttempts = 0;
        gameArea.className = "game-area idle";
        gameMessage.textContent = "Click to Start";
        gameInstruction.textContent = "Press Space or Click";
      }

      function getRandomDelay() {
        const delays = {
          easy: { min: 3000, max: 6000 },
          medium: { min: 2000, max: 5000 },
          hard: { min: 1000, max: 3000 },
        };
        const { min, max } = delays[currentDifficulty];
        return Math.random() * (max - min) + min;
      }

      function getRating(time) {
        if (time < 200) return { text: "Excellent! ⚡", class: "excellent" };
        if (time < 250) return { text: "Great! 🔥", class: "great" };
        if (time < 300) return { text: "Good! 👍", class: "good" };
        if (time < 400) return { text: "Average 💪", class: "average" };
        return { text: "Slow 🐢", class: "slow" };
      }

      function updateStats() {
        if (attempts.length === 0) {
          bestTimeEl.textContent = "-";
          lastTimeEl.textContent = "-";
          avgTimeEl.textContent = "-";
          totalAttemptsEl.textContent = "0";
          bestRatingEl.textContent = "-";
          lastRatingEl.textContent = "-";
          avgRatingEl.textContent = "-";
          attemptsSection.style.display = "none";
          chartSection.style.display = "none";
          return;
        }

        attemptsSection.style.display = "block";
        chartSection.style.display = "block";

        const best = Math.min(...attempts);
        const last = attempts[attempts.length - 1];
        const avg = Math.round(
          attempts.reduce((a, b) => a + b, 0) / attempts.length
        );

        bestTimeEl.textContent = `${best}ms`;
        lastTimeEl.textContent = `${last}ms`;
        avgTimeEl.textContent = `${avg}ms`;
        totalAttemptsEl.textContent = attempts.length;

        const bestRating = getRating(best);
        const lastRating = getRating(last);
        const avgRating = getRating(avg);

        bestTimeEl.className = `stat-value ${bestRating.class}`;
        lastTimeEl.className = `stat-value ${lastRating.class}`;
        avgTimeEl.className = `stat-value ${avgRating.class}`;

        bestRatingEl.textContent = bestRating.text;
        lastRatingEl.textContent = lastRating.text;
        avgRatingEl.textContent = avgRating.text;
      }

      function updateAttemptsList() {
        attemptsListEl.innerHTML = "";
        const recentAttempts = attempts.slice(-10).reverse();

        recentAttempts.forEach((time) => {
          const badge = document.createElement("div");
          const rating = getRating(time);
          badge.className = `attempt-badge ${rating.class}`;
          badge.textContent = `${time}ms`;
          badge.setAttribute("role", "listitem");
          attemptsListEl.appendChild(badge);
        });
      }

      function updateChart() {
        chartEl.innerHTML = "";
        const recentAttempts = attempts.slice(-20);
        const maxTime = Math.max(...recentAttempts);

        recentAttempts.forEach((time) => {
          const bar = document.createElement("div");
          const height = (time / maxTime) * 100;
          bar.className = "chart-bar";
          bar.style.height = `${height}%`;

          const tooltip = document.createElement("div");
          tooltip.className = "chart-bar-tooltip";
          tooltip.textContent = `${time}ms`;
          bar.appendChild(tooltip);

          chartEl.appendChild(bar);
        });
      }

      function addToLeaderboard(time) {
        const entry = {
          time: time,
          mode: currentMode,
          difficulty: currentDifficulty,
          date: new Date().toISOString(),
        };

        leaderboard.push(entry);
        leaderboard.sort((a, b) => a.time - b.time);
        leaderboard = leaderboard.slice(0, 10);
      }

      function updateLeaderboard() {
        if (leaderboard.length === 0) {
          leaderboardSection.style.display = "none";
          return;
        }

        leaderboardSection.style.display = "block";
        leaderboardBodyEl.innerHTML = "";

        leaderboard.forEach((entry, index) => {
          const row = document.createElement("tr");
          const rankClass =
            index === 0
              ? "rank-1"
              : index === 1
              ? "rank-2"
              : index === 2
              ? "rank-3"
              : "rank-other";

          row.innerHTML = `
                    <td><span class="rank-badge ${rankClass}">${
            index + 1
          }</span></td>
                    <td><strong>${entry.time}ms</strong></td>
                    <td>${
                      entry.mode.charAt(0).toUpperCase() + entry.mode.slice(1)
                    }</td>
                    <td>${new Date(entry.date).toLocaleDateString()}</td>
                `;

          leaderboardBodyEl.appendChild(row);
        });
      }

      function handleModeChange() {
        currentMode = gameModeSelect.value;
        resetGame();

        switch (currentMode) {
          case "classic":
            maxAttemptsForMode = 1;
            break;
          case "precision":
            maxAttemptsForMode = 5;
            break;
          case "endurance":
            maxAttemptsForMode = 10;
            break;
        }

        announceToScreenReader(`Mode: ${currentMode}`);
      }

      function handleDifficultyChange() {
        currentDifficulty = difficultySelect.value;
        resetGame();
        announceToScreenReader(`Difficulty: ${currentDifficulty}`);
      }

      function resetStats() {
        if (!confirm("Reset all statistics?")) return;

        attempts = [];
        sessionAttempts = 0;
        updateStats();
        updateAttemptsList();
        updateChart();
        saveToStorage();
        resetGame();
        announceToScreenReader("Statistics reset");
      }

      function clearLeaderboard() {
        if (!confirm("Clear the leaderboard?")) return;

        leaderboard = [];
        updateLeaderboard();
        saveToStorage();
        announceToScreenReader("Leaderboard cleared");
      }

      function exportResults() {
        const data = {
          attempts: attempts,
          leaderboard: leaderboard,
          stats: {
            best: attempts.length > 0 ? Math.min(...attempts) : null,
            average:
              attempts.length > 0
                ? Math.round(
                    attempts.reduce((a, b) => a + b, 0) / attempts.length
                  )
                : null,
            total: attempts.length,
          },
          exportDate: new Date().toISOString(),
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `reaction-time-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        announceToScreenReader("Results exported");
      }

      async function shareResults() {
        if (attempts.length === 0) {
          alert("No results to share yet!");
          return;
        }

        const best = Math.min(...attempts);
        const avg = Math.round(
          attempts.reduce((a, b) => a + b, 0) / attempts.length
        );
        const text = `I tested my reaction time! 🎯\nBest: ${best}ms\nAverage: ${avg}ms\nTotal: ${attempts.length}`;

        if (navigator.share) {
          try {
            await navigator.share({
              title: "Reaction Time Test",
              text: text,
              url: window.location.href,
            });
          } catch (err) {
            if (err.name !== "AbortError") {
              copyToClipboard(text);
            }
          }
        } else {
          copyToClipboard(text);
        }
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert("Copied to clipboard!");
          })
          .catch(() => {
            alert("Failed to copy");
          });
      }

      function playSound(type) {
        if (!soundEnabled) return;

        if (!audioContext) {
          audioContext = new AudioContext();
        }

        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        if (type === "go") {
          oscillator.frequency.value = 880;
          oscillator.type = "sine";
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.1
          );
        } else if (type === "success") {
          oscillator.frequency.value = 523.25;
          oscillator.type = "sine";
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.2
          );
        } else if (type === "error") {
          oscillator.frequency.value = 200;
          oscillator.type = "sawtooth";
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.15
          );
        }

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      }

      function vibrate(pattern) {
        if (!vibrationEnabled || !navigator.vibrate) return;
        navigator.vibrate(pattern);
      }

      function saveToStorage() {
        try {
          localStorage.setItem(
            "reactionTimeAttempts",
            JSON.stringify(attempts)
          );
          localStorage.setItem(
            "reactionTimeLeaderboard",
            JSON.stringify(leaderboard)
          );
        } catch (e) {
          console.error("Failed to save:", e);
        }
      }

      function loadFromStorage() {
        try {
          const savedAttempts = localStorage.getItem("reactionTimeAttempts");
          const savedLeaderboard = localStorage.getItem(
            "reactionTimeLeaderboard"
          );

          if (savedAttempts) {
            attempts = JSON.parse(savedAttempts);
          }

          if (savedLeaderboard) {
            leaderboard = JSON.parse(savedLeaderboard);
          }
        } catch (e) {
          console.error("Failed to load:", e);
        }
      }

      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("role", "status");
        announcement.setAttribute("aria-live", "polite");
        announcement.className = "sr-only";
        announcement.textContent = message;
        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      }

      init();
    </script>
  </body>
</html>
