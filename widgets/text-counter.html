<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Advanced Text Counter - Character, Word, & Reading Time Analysis |
      iowidgets
    </title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-S15806B1HW"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-S15806B1HW");
    </script>
    <meta
      name="description"
      content="Professional text analysis tool with real-time character, word, sentence, paragraph counting, reading time estimation, keyword density analysis, and text statistics. Export reports in multiple formats."
    />
    <meta
      name="keywords"
      content="text counter, character counter, word counter, reading time calculator, text analysis, keyword density, text statistics, writing tool, content analyzer"
    />
    <link
      rel="canonical"
      href="https://iowidgets.com/widgets/text-counter.html"
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Advanced Text Counter - Character & Word Analysis Tool"
    />
    <meta
      property="og:description"
      content="Analyze your text with real-time statistics: characters, words, sentences, reading time, keyword density, and more. Perfect for writers and content creators."
    />
    <meta
      property="og:url"
      content="https://iowidgets.com/widgets/text-counter.html"
    />
    <meta
      property="og:image"
      content="https://iowidgets.com/assets/og-text-counter.png"
    />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Advanced Text Counter - Character & Word Analysis Tool"
    />
    <meta
      name="twitter:description"
      content="Real-time text analysis with character counting, word counting, reading time estimation, and keyword density analysis."
    />
    <meta
      name="twitter:image"
      content="https://iowidgets.com/assets/og-text-counter.png"
    />

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Advanced Text Counter",
        "description": "Professional text analysis tool with real-time character, word, and statistics counting",
        "url": "https://iowidgets.com/widgets/text-counter.html",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "Real-time character counting",
          "Word and sentence counting",
          "Reading time estimation",
          "Keyword density analysis",
          "Text statistics dashboard",
          "Export to CSV/JSON/TXT",
          "Character limit checking",
          "5 color themes",
          "Keyboard shortcuts",
          "Text history tracking"
        ]
      }
    </script>
    <style>
      :root {
        --primary: #fa709a;
        --primary-dark: #e65a84;
        --primary-light: #ffa6c1;
        --secondary: #fee140;
        --background: #ffffff;
        --surface: #f8f9fa;
        --text-primary: #1a1a1a;
        --text-secondary: #666666;
        --border: #e0e0e0;
        --shadow: rgba(0, 0, 0, 0.1);
        --shadow-lg: rgba(0, 0, 0, 0.2);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #3b82f6;

        --spacing-xs: 0.5rem;
        --spacing-sm: 0.75rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;

        --font-size-xs: clamp(0.75rem, 2vw, 0.875rem);
        --font-size-sm: clamp(0.875rem, 2.5vw, 0.9375rem);
        --font-size-base: clamp(1rem, 3vw, 1.125rem);
        --font-size-lg: clamp(1.125rem, 3.5vw, 1.25rem);
        --font-size-xl: clamp(1.25rem, 4vw, 1.5rem);
        --font-size-2xl: clamp(1.5rem, 5vw, 2rem);
        --font-size-3xl: clamp(2rem, 6vw, 2.5rem);

        --radius-sm: 0.5rem;
        --radius-md: 0.75rem;
        --radius-lg: 1rem;
        --radius-xl: 1.5rem;

        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      [data-theme="blue"] {
        --primary: #3b82f6;
        --primary-dark: #2563eb;
        --primary-light: #60a5fa;
        --secondary: #93c5fd;
      }

      [data-theme="green"] {
        --primary: #10b981;
        --primary-dark: #059669;
        --primary-light: #34d399;
        --secondary: #6ee7b7;
      }

      [data-theme="purple"] {
        --primary: #a855f7;
        --primary-dark: #9333ea;
        --primary-light: #c084fc;
        --secondary: #d8b4fe;
      }

      [data-theme="orange"] {
        --primary: #f97316;
        --primary-dark: #ea580c;
        --primary-light: #fb923c;
        --secondary: #fdba74;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-md);
        color: var(--text-primary);
        line-height: 1.6;
        transition: var(--transition);
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        box-shadow: 0 20px 60px var(--shadow-lg),
          0 0 0 1px rgba(255, 255, 255, 0.5);
        max-width: 900px;
        width: 100%;
        animation: slideUp 0.5s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
        gap: var(--spacing-md);
      }

      h1 {
        font-size: var(--font-size-2xl);
        color: var(--text-primary);
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .theme-selector {
        display: flex;
        gap: var(--spacing-xs);
        flex-wrap: wrap;
      }

      .theme-btn {
        width: 44px;
        height: 44px;
        border: 2px solid transparent;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition);
        background: var(--color);
        position: relative;
      }

      .theme-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .theme-btn.active {
        border-color: var(--text-primary);
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
      }

      .theme-btn:focus-visible {
        outline: 3px solid var(--primary);
        outline-offset: 2px;
      }

      .theme-btn[data-theme="pink"] {
        --color: #fa709a;
      }
      .theme-btn[data-theme="blue"] {
        --color: #3b82f6;
      }
      .theme-btn[data-theme="green"] {
        --color: #10b981;
      }
      .theme-btn[data-theme="purple"] {
        --color: #a855f7;
      }
      .theme-btn[data-theme="orange"] {
        --color: #f97316;
      }

      .controls {
        display: flex;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-lg);
        flex-wrap: wrap;
        align-items: center;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        background: var(--surface);
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--radius-md);
      }

      .control-group label {
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
        font-weight: 600;
      }

      .control-group input[type="number"] {
        width: 80px;
        padding: var(--spacing-xs);
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-sm);
        font-family: inherit;
      }

      .control-group input[type="number"]:focus {
        outline: none;
        border-color: var(--primary);
      }

      .btn {
        min-width: 44px;
        min-height: 44px;
        padding: var(--spacing-sm) var(--spacing-md);
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-size: var(--font-size-sm);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        white-space: nowrap;
      }

      .btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:focus-visible {
        outline: 3px solid var(--primary-light);
        outline-offset: 2px;
      }

      .btn-secondary {
        background: var(--surface);
        color: var(--text-primary);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      .textarea-wrapper {
        position: relative;
        margin-bottom: var(--spacing-lg);
      }

      textarea {
        width: 100%;
        min-height: 250px;
        padding: var(--spacing-md);
        border: 2px solid var(--border);
        border-radius: var(--radius-lg);
        font-size: var(--font-size-base);
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        resize: vertical;
        line-height: 1.6;
        transition: var(--transition);
      }

      textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(250, 112, 154, 0.1);
      }

      textarea::placeholder {
        color: var(--text-secondary);
        opacity: 0.6;
      }

      .char-limit-warning {
        position: absolute;
        bottom: -30px;
        right: 0;
        font-size: var(--font-size-sm);
        color: var(--warning);
        font-weight: 600;
        display: none;
        animation: pulse 1s infinite;
      }

      .char-limit-warning.show {
        display: block;
      }

      .char-limit-warning.danger {
        color: var(--danger);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }

      .tabs {
        display: flex;
        gap: var(--spacing-xs);
        margin-bottom: var(--spacing-lg);
        border-bottom: 2px solid var(--border);
        overflow-x: auto;
      }

      .tab {
        padding: var(--spacing-sm) var(--spacing-md);
        min-height: 44px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: var(--font-size-sm);
        font-weight: 600;
        color: var(--text-secondary);
        transition: var(--transition);
        white-space: nowrap;
      }

      .tab:hover {
        color: var(--primary);
      }

      .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
      }

      .tab:focus-visible {
        outline: 3px solid var(--primary);
        outline-offset: 2px;
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.3s ease-out;
      }

      .tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--spacing-md);
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          var(--surface) 0%,
          rgba(250, 112, 154, 0.05) 100%
        );
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        text-align: center;
        border: 2px solid transparent;
        transition: var(--transition);
      }

      .stat-card:hover {
        border-color: var(--primary);
        transform: translateY(-4px);
        box-shadow: 0 8px 24px var(--shadow);
      }

      .stat-value {
        font-size: var(--font-size-3xl);
        font-weight: 700;
        color: var(--primary);
        margin-bottom: var(--spacing-xs);
        font-variant-numeric: tabular-nums;
      }

      .stat-label {
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .keyword-analysis {
        margin-top: var(--spacing-lg);
      }

      .keyword-list {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
      }

      .keyword-item {
        background: var(--surface);
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: var(--radius-lg);
        font-size: var(--font-size-sm);
        border: 2px solid var(--border);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }

      .keyword-word {
        font-weight: 600;
        color: var(--text-primary);
      }

      .keyword-count {
        background: var(--primary);
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: var(--font-size-xs);
        font-weight: 700;
      }

      .export-section {
        display: flex;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-lg);
        flex-wrap: wrap;
      }

      .history-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .history-item {
        background: var(--surface);
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        border: 2px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
      }

      .history-item:hover {
        border-color: var(--primary);
        background: white;
      }

      .history-date {
        font-size: var(--font-size-xs);
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
      }

      .history-preview {
        font-size: var(--font-size-sm);
        color: var(--text-primary);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .empty-state {
        text-align: center;
        padding: var(--spacing-2xl);
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: var(--font-size-3xl);
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      @media (max-width: 640px) {
        .container {
          padding: var(--spacing-md);
        }

        header {
          flex-direction: column;
          align-items: flex-start;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .control-group {
          justify-content: space-between;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      @media (prefers-contrast: high) {
        .container {
          border: 3px solid var(--text-primary);
        }

        .stat-card,
        .keyword-item,
        .history-item {
          border-width: 3px;
        }
      }

      @media print {
        body {
          background: white;
        }

        .container {
          box-shadow: none;
          padding: 0;
        }

        .controls,
        .export-section,
        .theme-selector,
        .tabs {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>
          <span aria-hidden="true">📝</span>
          Text Counter
        </h1>
        <div class="theme-selector" role="group" aria-label="Theme selection">
          <button
            class="theme-btn active"
            data-theme="pink"
            aria-label="Pink theme"
            aria-pressed="true"
          ></button>
          <button
            class="theme-btn"
            data-theme="blue"
            aria-label="Blue theme"
            aria-pressed="false"
          ></button>
          <button
            class="theme-btn"
            data-theme="green"
            aria-label="Green theme"
            aria-pressed="false"
          ></button>
          <button
            class="theme-btn"
            data-theme="purple"
            aria-label="Purple theme"
            aria-pressed="false"
          ></button>
          <button
            class="theme-btn"
            data-theme="orange"
            aria-label="Orange theme"
            aria-pressed="false"
          ></button>
        </div>
      </header>

      <div class="controls">
        <div class="control-group">
          <label for="charLimit">Character Limit:</label>
          <input
            type="number"
            id="charLimit"
            value="0"
            min="0"
            max="100000"
            aria-label="Set character limit (0 for unlimited)"
          />
        </div>
        <button class="btn" id="copyBtn" aria-label="Copy text to clipboard">
          <span aria-hidden="true">📋</span> Copy
        </button>
        <button
          class="btn btn-secondary"
          id="clearBtn"
          aria-label="Clear all text"
        >
          <span aria-hidden="true">🗑️</span> Clear
        </button>
        <button
          class="btn btn-secondary"
          id="speakBtn"
          aria-label="Read text aloud"
        >
          <span aria-hidden="true">🔊</span> Speak
        </button>
      </div>

      <div class="textarea-wrapper">
        <textarea
          id="textInput"
          placeholder="Start typing or paste your text here... (Ctrl/Cmd + Enter to save)"
          aria-label="Text input area"
          aria-describedby="charLimitWarning"
        ></textarea>
        <div
          id="charLimitWarning"
          class="char-limit-warning"
          role="status"
          aria-live="polite"
        ></div>
      </div>

      <div class="tabs" role="tablist">
        <button
          class="tab active"
          data-tab="stats"
          role="tab"
          aria-selected="true"
          aria-controls="stats-panel"
        >
          Statistics
        </button>
        <button
          class="tab"
          data-tab="keywords"
          role="tab"
          aria-selected="false"
          aria-controls="keywords-panel"
        >
          Keywords
        </button>
        <button
          class="tab"
          data-tab="export"
          role="tab"
          aria-selected="false"
          aria-controls="export-panel"
        >
          Export
        </button>
        <button
          class="tab"
          data-tab="history"
          role="tab"
          aria-selected="false"
          aria-controls="history-panel"
        >
          History
        </button>
      </div>

      <main>
        <div
          id="stats-panel"
          class="tab-content active"
          role="tabpanel"
          aria-labelledby="stats-tab"
        >
          <div class="stats">
            <div class="stat-card">
              <div class="stat-value" id="charCount">0</div>
              <div class="stat-label">Characters</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="charNoSpaceCount">0</div>
              <div class="stat-label">Chars (No Space)</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="wordCount">0</div>
              <div class="stat-label">Words</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="uniqueWordCount">0</div>
              <div class="stat-label">Unique Words</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="lineCount">0</div>
              <div class="stat-label">Lines</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="sentenceCount">0</div>
              <div class="stat-label">Sentences</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="paragraphCount">0</div>
              <div class="stat-label">Paragraphs</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="readTime">0</div>
              <div class="stat-label">Min Read</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="speakTime">0</div>
              <div class="stat-label">Speak Time</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="avgWordLength">0</div>
              <div class="stat-label">Avg Word Len</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="avgSentenceLength">0</div>
              <div class="stat-label">Avg Sentence</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="longestWord">-</div>
              <div class="stat-label">Longest Word</div>
            </div>
          </div>
        </div>

        <div
          id="keywords-panel"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="keywords-tab"
        >
          <div class="keyword-analysis">
            <h2
              style="
                font-size: var(--font-size-lg);
                margin-bottom: var(--spacing-md);
                color: var(--text-primary);
              "
            >
              Top Keywords (min 3 letters)
            </h2>
            <div id="keywordList" class="keyword-list">
              <div class="empty-state">
                <div class="empty-state-icon">🔍</div>
                <p>Start typing to see keyword analysis</p>
              </div>
            </div>
          </div>
        </div>

        <div
          id="export-panel"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="export-tab"
        >
          <div class="export-section">
            <button
              class="btn"
              id="exportTxtBtn"
              aria-label="Export text as TXT file"
            >
              <span aria-hidden="true">📄</span> Export TXT
            </button>
            <button
              class="btn"
              id="exportCsvBtn"
              aria-label="Export statistics as CSV"
            >
              <span aria-hidden="true">📊</span> Export CSV
            </button>
            <button
              class="btn"
              id="exportJsonBtn"
              aria-label="Export statistics as JSON"
            >
              <span aria-hidden="true">📋</span> Export JSON
            </button>
            <button
              class="btn btn-secondary"
              id="saveHistoryBtn"
              aria-label="Save to history"
            >
              <span aria-hidden="true">💾</span> Save to History
            </button>
            <button
              class="btn btn-secondary"
              id="clearHistoryBtn"
              aria-label="Clear all history"
            >
              <span aria-hidden="true">🗑️</span> Clear History
            </button>
          </div>
        </div>

        <div
          id="history-panel"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="history-tab"
        >
          <div id="historyList" class="history-list">
            <div class="empty-state">
              <div class="empty-state-icon">📚</div>
              <p>No saved history yet</p>
              <p
                style="
                  font-size: var(--font-size-sm);
                  margin-top: var(--spacing-sm);
                "
              >
                Press Ctrl/Cmd + Enter to save current text
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script>
      let history = [];
      let currentTheme = "pink";

      function init() {
        loadSettings();
        setupEventListeners();
        updateStats();
      }

      function setupEventListeners() {
        const textarea = document.getElementById("textInput");
        textarea.addEventListener("input", handleInput);
        textarea.addEventListener("paste", handlePaste);

        document
          .getElementById("charLimit")
          .addEventListener("input", updateStats);
        document.getElementById("copyBtn").addEventListener("click", copyText);
        document
          .getElementById("clearBtn")
          .addEventListener("click", clearText);
        document
          .getElementById("speakBtn")
          .addEventListener("click", speakText);

        document
          .getElementById("exportTxtBtn")
          .addEventListener("click", exportTxt);
        document
          .getElementById("exportCsvBtn")
          .addEventListener("click", exportCsv);
        document
          .getElementById("exportJsonBtn")
          .addEventListener("click", exportJson);
        document
          .getElementById("saveHistoryBtn")
          .addEventListener("click", saveToHistory);
        document
          .getElementById("clearHistoryBtn")
          .addEventListener("click", clearHistory);

        document.querySelectorAll(".theme-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document.querySelectorAll(".theme-btn").forEach((b) => {
              b.classList.remove("active");
              b.setAttribute("aria-pressed", "false");
            });
            this.classList.add("active");
            this.setAttribute("aria-pressed", "true");
            currentTheme = this.dataset.theme;
            document.body.dataset.theme = currentTheme;
            saveSettings();
          });
        });

        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabName = this.dataset.tab;
            document.querySelectorAll(".tab").forEach((t) => {
              t.classList.remove("active");
              t.setAttribute("aria-selected", "false");
            });
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));
            this.classList.add("active");
            this.setAttribute("aria-selected", "true");
            document.getElementById(`${tabName}-panel`).classList.add("active");
          });
        });

        document.addEventListener("keydown", handleKeyPress);
      }

      function handleKeyPress(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          saveToHistory();
        }
      }

      function handleInput() {
        updateStats();
        checkCharacterLimit();
      }

      function handlePaste(e) {
        setTimeout(() => {
          updateStats();
          checkCharacterLimit();
        }, 0);
      }

      function updateStats() {
        const text = document.getElementById("textInput").value;

        // Characters
        const charCount = text.length;
        document.getElementById("charCount").textContent = charCount;

        // Characters without spaces
        const charNoSpace = text.replace(/\s/g, "").length;
        document.getElementById("charNoSpaceCount").textContent = charNoSpace;

        // Words
        const words = text
          .trim()
          .split(/\s+/)
          .filter((word) => word.length > 0);
        const wordCount = words.length;
        document.getElementById("wordCount").textContent = wordCount;

        // Unique words
        const uniqueWords = new Set(
          words.map((w) => w.toLowerCase().replace(/[^\w]/g, ""))
        );
        document.getElementById("uniqueWordCount").textContent =
          uniqueWords.size;

        // Lines
        const lines = text.split("\n").length;
        document.getElementById("lineCount").textContent = lines;

        // Sentences
        const sentences = text
          .split(/[.!?]+/)
          .filter((s) => s.trim().length > 0);
        const sentenceCount = sentences.length;
        document.getElementById("sentenceCount").textContent = sentenceCount;

        // Paragraphs
        const paragraphs = text
          .split(/\n\n+/)
          .filter((p) => p.trim().length > 0);
        document.getElementById("paragraphCount").textContent =
          paragraphs.length;

        // Reading time (average 200 words per minute)
        const readTime = Math.ceil(wordCount / 200);
        document.getElementById("readTime").textContent = readTime || 0;

        // Speaking time (average 150 words per minute)
        const speakTime = Math.ceil(wordCount / 150);
        document.getElementById("speakTime").textContent = speakTime || 0;

        // Average word length
        const totalWordLength = words.reduce(
          (sum, word) => sum + word.length,
          0
        );
        const avgWordLength =
          wordCount > 0 ? (totalWordLength / wordCount).toFixed(1) : 0;
        document.getElementById("avgWordLength").textContent = avgWordLength;

        // Average sentence length
        const avgSentenceLength =
          sentenceCount > 0 ? Math.round(wordCount / sentenceCount) : 0;
        document.getElementById("avgSentenceLength").textContent =
          avgSentenceLength;

        // Longest word
        const longestWord = words.reduce(
          (longest, word) => (word.length > longest.length ? word : longest),
          ""
        );
        document.getElementById("longestWord").textContent = longestWord || "-";

        // Update keyword analysis
        updateKeywordAnalysis(words);
      }

      function updateKeywordAnalysis(words) {
        const keywordList = document.getElementById("keywordList");

        if (words.length === 0) {
          keywordList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">🔍</div>
              <p>Start typing to see keyword analysis</p>
            </div>`;
          return;
        }

        // Count word frequency
        const frequency = {};
        words.forEach((word) => {
          const cleanWord = word.toLowerCase().replace(/[^\w]/g, "");
          if (cleanWord.length >= 3) {
            frequency[cleanWord] = (frequency[cleanWord] || 0) + 1;
          }
        });

        // Sort by frequency
        const sorted = Object.entries(frequency)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 15);

        if (sorted.length === 0) {
          keywordList.innerHTML = `
            <div class="empty-state">
              <p>No keywords found (min 3 letters)</p>
            </div>`;
          return;
        }

        keywordList.innerHTML = sorted
          .map(
            ([word, count]) => `
          <div class="keyword-item">
            <span class="keyword-word">${word}</span>
            <span class="keyword-count">${count}</span>
          </div>
        `
          )
          .join("");
      }

      function checkCharacterLimit() {
        const text = document.getElementById("textInput").value;
        const limit = parseInt(document.getElementById("charLimit").value) || 0;
        const warning = document.getElementById("charLimitWarning");

        if (limit > 0) {
          const remaining = limit - text.length;
          if (remaining <= 0) {
            warning.textContent = `Character limit exceeded by ${Math.abs(
              remaining
            )}`;
            warning.classList.add("show", "danger");
          } else if (remaining <= 50) {
            warning.textContent = `${remaining} characters remaining`;
            warning.classList.add("show");
            warning.classList.remove("danger");
          } else {
            warning.classList.remove("show");
          }
        } else {
          warning.classList.remove("show");
        }
      }

      function copyText() {
        const textarea = document.getElementById("textInput");
        textarea.select();
        document.execCommand("copy");

        const btn = document.getElementById("copyBtn");
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span aria-hidden="true">✅</span> Copied!';
        setTimeout(() => {
          btn.innerHTML = originalText;
        }, 2000);

        announceToScreenReader("Text copied to clipboard");
      }

      function clearText() {
        if (confirm("Clear all text?")) {
          document.getElementById("textInput").value = "";
          updateStats();
          announceToScreenReader("Text cleared");
        }
      }

      function speakText() {
        const text = document.getElementById("textInput").value;

        if (!text.trim()) {
          alert("No text to read!");
          return;
        }

        if ("speechSynthesis" in window) {
          window.speechSynthesis.cancel();

          const utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = 1.0;
          utterance.pitch = 1.0;
          utterance.volume = 1.0;

          const btn = document.getElementById("speakBtn");
          const originalText = btn.innerHTML;
          btn.innerHTML = '<span aria-hidden="true">⏸️</span> Speaking...';

          utterance.onend = () => {
            btn.innerHTML = originalText;
          };

          utterance.onerror = () => {
            btn.innerHTML = originalText;
            alert("Speech synthesis failed");
          };

          window.speechSynthesis.speak(utterance);
          announceToScreenReader("Reading text aloud");
        } else {
          alert("Text-to-speech not supported in this browser");
        }
      }

      function exportTxt() {
        const text = document.getElementById("textInput").value;

        if (!text.trim()) {
          alert("No text to export!");
          return;
        }

        const blob = new Blob([text], { type: "text/plain" });
        downloadFile(blob, `text-export-${Date.now()}.txt`);
        announceToScreenReader("Text exported as TXT file");
      }

      function exportCsv() {
        const text = document.getElementById("textInput").value;

        if (!text.trim()) {
          alert("No text to export!");
          return;
        }

        const stats = {
          Metric: [
            "Characters",
            "Characters (No Space)",
            "Words",
            "Unique Words",
            "Lines",
            "Sentences",
            "Paragraphs",
            "Reading Time (min)",
            "Speaking Time (min)",
            "Avg Word Length",
            "Avg Sentence Length",
          ],
          Value: [
            document.getElementById("charCount").textContent,
            document.getElementById("charNoSpaceCount").textContent,
            document.getElementById("wordCount").textContent,
            document.getElementById("uniqueWordCount").textContent,
            document.getElementById("lineCount").textContent,
            document.getElementById("sentenceCount").textContent,
            document.getElementById("paragraphCount").textContent,
            document.getElementById("readTime").textContent,
            document.getElementById("speakTime").textContent,
            document.getElementById("avgWordLength").textContent,
            document.getElementById("avgSentenceLength").textContent,
          ],
        };

        const csv =
          "Metric,Value\n" +
          stats.Metric.map((m, i) => `"${m}","${stats.Value[i]}"`).join("\n");
        const blob = new Blob([csv], { type: "text/csv" });
        downloadFile(blob, `text-stats-${Date.now()}.csv`);
        announceToScreenReader("Statistics exported as CSV file");
      }

      function exportJson() {
        const text = document.getElementById("textInput").value;

        if (!text.trim()) {
          alert("No text to export!");
          return;
        }

        const data = {
          text: text,
          statistics: {
            characters: document.getElementById("charCount").textContent,
            charactersNoSpace:
              document.getElementById("charNoSpaceCount").textContent,
            words: document.getElementById("wordCount").textContent,
            uniqueWords: document.getElementById("uniqueWordCount").textContent,
            lines: document.getElementById("lineCount").textContent,
            sentences: document.getElementById("sentenceCount").textContent,
            paragraphs: document.getElementById("paragraphCount").textContent,
            readingTime: document.getElementById("readTime").textContent,
            speakingTime: document.getElementById("speakTime").textContent,
            avgWordLength: document.getElementById("avgWordLength").textContent,
            avgSentenceLength:
              document.getElementById("avgSentenceLength").textContent,
            longestWord: document.getElementById("longestWord").textContent,
          },
          exportDate: new Date().toISOString(),
        };

        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: "application/json" });
        downloadFile(blob, `text-analysis-${Date.now()}.json`);
        announceToScreenReader("Analysis exported as JSON file");
      }

      function downloadFile(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      }

      function saveToHistory() {
        const text = document.getElementById("textInput").value;

        if (!text.trim()) {
          alert("No text to save!");
          return;
        }

        const entry = {
          id: Date.now(),
          text: text,
          date: new Date().toISOString(),
          preview: text.substring(0, 100),
          stats: {
            characters: document.getElementById("charCount").textContent,
            words: document.getElementById("wordCount").textContent,
          },
        };

        history.unshift(entry);
        if (history.length > 50) {
          history = history.slice(0, 50);
        }

        try {
          localStorage.setItem("textCounterHistory", JSON.stringify(history));
          updateHistoryDisplay();
          alert("Text saved to history!");
          announceToScreenReader("Text saved to history");
        } catch (e) {
          alert("Failed to save to history");
        }
      }

      function clearHistory() {
        if (confirm("Clear all history?")) {
          history = [];
          localStorage.removeItem("textCounterHistory");
          updateHistoryDisplay();
          announceToScreenReader("History cleared");
        }
      }

      function updateHistoryDisplay() {
        const historyList = document.getElementById("historyList");

        if (history.length === 0) {
          historyList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">📚</div>
              <p>No saved history yet</p>
              <p style="font-size: var(--font-size-sm); margin-top: var(--spacing-sm);">
                Press Ctrl/Cmd + Enter to save current text
              </p>
            </div>`;
          return;
        }

        historyList.innerHTML = history
          .map(
            (entry) => `
          <div class="history-item" data-id="${
            entry.id
          }" role="button" tabindex="0">
            <div class="history-date">${new Date(
              entry.date
            ).toLocaleString()}</div>
            <div class="history-preview">${entry.preview}${
              entry.text.length > 100 ? "..." : ""
            }</div>
            <div style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: var(--spacing-xs);">
              ${entry.stats.characters} chars • ${entry.stats.words} words
            </div>
          </div>
        `
          )
          .join("");

        document.querySelectorAll(".history-item").forEach((item) => {
          item.addEventListener("click", function () {
            loadHistoryItem(parseInt(this.dataset.id));
          });
          item.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              loadHistoryItem(parseInt(this.dataset.id));
            }
          });
        });
      }

      function loadHistoryItem(id) {
        const entry = history.find((e) => e.id === id);
        if (entry) {
          document.getElementById("textInput").value = entry.text;
          updateStats();
          document.querySelector('.tab[data-tab="stats"]').click();
          announceToScreenReader("History item loaded");
        }
      }

      function saveSettings() {
        const settings = {
          theme: currentTheme,
          charLimit: document.getElementById("charLimit").value,
        };
        try {
          localStorage.setItem("textCounterSettings", JSON.stringify(settings));
        } catch (e) {
          console.error("Failed to save settings:", e);
        }
      }

      function loadSettings() {
        try {
          const savedSettings = localStorage.getItem("textCounterSettings");
          if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            currentTheme = settings.theme || "pink";
            document.body.dataset.theme = currentTheme;

            if (settings.charLimit) {
              document.getElementById("charLimit").value = settings.charLimit;
            }

            document.querySelectorAll(".theme-btn").forEach((btn) => {
              if (btn.dataset.theme === currentTheme) {
                btn.classList.add("active");
                btn.setAttribute("aria-pressed", "true");
              } else {
                btn.classList.remove("active");
                btn.setAttribute("aria-pressed", "false");
              }
            });
          }

          const savedHistory = localStorage.getItem("textCounterHistory");
          if (savedHistory) {
            history = JSON.parse(savedHistory);
            updateHistoryDisplay();
          }
        } catch (e) {
          console.error("Failed to load settings:", e);
        }
      }

      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("role", "status");
        announcement.setAttribute("aria-live", "polite");
        announcement.className = "sr-only";
        announcement.textContent = message;
        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      }

      init();
    </script>
  </body>
</html>
